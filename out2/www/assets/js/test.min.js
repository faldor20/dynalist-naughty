"use strict";
!(function () {
  Function.prototype.bind ||
    (Function.prototype.bind = function (t) {
      if ("function" != typeof this)
        throw new TypeError(
          "Function.prototype.bind - what is trying to be bound is not callable",
        );
      var e = Array.prototype.slice.call(arguments, 1),
        n = this,
        r = function () {},
        i = function () {
          return n.apply(
            this instanceof r ? this : t,
            e.concat(Array.prototype.slice.call(arguments)),
          );
        };
      return (
        this.prototype && (r.prototype = this.prototype),
        (i.prototype = new r()),
        i
      );
    }),
    Array.prototype.every ||
      (Array.prototype.every = function (t, e) {
        var n, r;
        if (null == this) throw new TypeError("this is null or not defined");
        var i = Object(this),
          o = i.length >>> 0;
        if ("function" != typeof t) throw new TypeError();
        for (1 < arguments.length && (n = e), r = 0; r < o; ) {
          var s = void 0;
          if (r in i) if (((s = i[r]), !t.call(n, s, r, i))) return !1;
          r++;
        }
        return !0;
      }),
    Array.prototype.some ||
      (Array.prototype.some = function (t) {
        if (null == this)
          throw new TypeError(
            "Array.prototype.some called on null or undefined",
          );
        if ("function" != typeof t) throw new TypeError();
        for (
          var e = Object(this),
            n = e.length >>> 0,
            r = 2 <= arguments.length ? arguments[1] : void 0,
            i = 0;
          i < n;
          i++
        )
          if (i in e && t.call(r, e[i], i, e)) return !0;
        return !1;
      }),
    Array.prototype.clone ||
      (Array.prototype.clone = function () {
        return this.slice(0);
      }),
    Array.prototype.cloneInline ||
      (Array.prototype.cloneInline = function () {
        for (var t = new Array(this.length), e = 0; e < this.length; e++)
          t[e] = this[e];
        return t;
      }),
    Array.prototype.first ||
      (Array.prototype.first = function () {
        return 0 === this.length ? null : this[0];
      }),
    Array.prototype.last ||
      (Array.prototype.last = function () {
        return 0 === this.length ? null : this[this.length - 1];
      }),
    Array.prototype.peek || (Array.prototype.peek = Array.prototype.last),
    Array.prototype.contains ||
      (Array.prototype.contains = function (t) {
        return -1 !== this.indexOf(t);
      }),
    Array.prototype.remove ||
      (Array.prototype.remove = function (t) {
        for (var e = this.length - 1; 0 <= e; e--)
          this[e] === t && this.splice(e, 1);
      }),
    Array.isArray ||
      (Array.isArray = function (t) {
        return "[object Array]" === Object.prototype.toString.call(t);
      }),
    Array.each ||
      ((Array.each = function (t, e, n) {
        for (var r = 0; r < t.length; r++)
          if (!1 === e.call(n, t[r], r, t)) return !1;
        return !0;
      }),
      (Array.eachReverse = function (t, e, n) {
        for (var r = t.length - 1; 0 <= r; r--)
          if (!1 === e.call(n, t[r], r, t)) return !1;
        return !0;
      })),
    Object.isEmpty ||
      (Object.isEmpty = function (t) {
        for (var e in t) if (t.hasOwnProperty(e)) return !1;
        return !0;
      }),
    Object.each ||
      (Object.each = function (t, e, n) {
        for (var r in t)
          if (t.hasOwnProperty(r) && !1 === e.call(n, t[r], r)) return !1;
        return !0;
      }),
    Object.getOrCreate ||
      (Object.getOrCreate = function (t, e, n) {
        var r = t[e];
        return r || ((r = n(e)), (t[e] = r)), r;
      }),
    "function" != typeof Object.assign &&
      Object.defineProperty(Object, "assign", {
        value: function t(e) {
          if (null == e)
            throw new TypeError("Cannot convert undefined or null to object");
          for (var n = Object(e), r = 1; r < arguments.length; r++) {
            var i = arguments[r];
            if (null != i)
              for (var o in i)
                Object.prototype.hasOwnProperty.call(i, o) && (n[o] = i[o]);
          }
          return n;
        },
        writable: !0,
        configurable: !0,
      }),
    String.isString ||
      (String.isString = function (t) {
        return "string" == typeof t || t instanceof String;
      }),
    String.prototype.contains ||
      (String.prototype.contains = function (t) {
        return -1 !== this.indexOf(t);
      }),
    String.prototype.startsWith ||
      (String.prototype.startsWith = function (t, e) {
        return this.substr(!e || e < 0 ? 0 : +e, t.length) === t;
      }),
    String.prototype.endsWith ||
      (String.prototype.endsWith = function (t, e) {
        return (
          (void 0 === e || e > this.length) && (e = this.length),
          this.substring(e - t.length, e) === t
        );
      }),
    Math.clamp ||
      (Math.clamp = function (t, e, n) {
        return Math.min(Math.max(t, e), n);
      }),
    Math.square ||
      (Math.square = function (t) {
        return t * t;
      }),
    Number.isInteger ||
      (Number.isInteger = function (t) {
        return "number" == typeof t && isFinite(t) && Math.floor(t) === t;
      }),
    document.hasFocus ||
      (document.hasFocus = function () {
        return "visible" === document.visibilityState;
      }),
    (navigator.vibrate =
      navigator.vibrate ||
      navigator.webkitVibrate ||
      navigator.mozVibrate ||
      navigator.msVibrate),
    Element.prototype.matches ||
      (Element.prototype.matches =
        Element.prototype.msMatchesSelector ||
        Element.prototype.webkitMatchesSelector),
    (Element.prototype.html = function (t) {
      if (void 0 === t) return this.innerHTML;
      this.innerHTML = t;
    }),
    (Node.prototype.getText = function () {
      var t = this,
        e = t.nodeType;
      if (1 !== e && 9 !== e && 11 !== e)
        return 3 === e || 4 === e ? t.nodeValue : "";
      if ("string" == typeof t.textContent) return t.textContent;
      for (var n = [], r = t.firstChild; r; r = r.nextSibling)
        n.push(r.getText());
      return n.join("");
    }),
    (Node.prototype.setText = function (t) {
      var e = this.nodeType;
      1 === e || 9 === e || 11 === e
        ? (this.textContent = t)
        : (3 !== e && 4 !== e) || (this.nodeValue = t);
    }),
    (Node.prototype.insertAfter = function (t) {
      t.parentNode && t.parentNode.insertBefore(this, t.nextSibling);
    }),
    (Node.prototype.append = function (t) {
      t.detach(), this.appendChild(t);
    }),
    (Node.prototype.appendEl = function (t) {
      t.parentNode !== this && t.detach(),
        this.lastChild !== t && this.appendChild(t);
    }),
    (Node.prototype.prepend = function (t) {
      t.detach(), this.insertBefore(t, this.firstChild);
    }),
    (Node.prototype.detach = function () {
      this.parentNode && this.parentNode.removeChild(this);
    }),
    (Node.prototype.empty = function () {
      for (; this.lastChild; ) this.removeChild(this.lastChild);
      return this;
    }),
    (Node.prototype.indexOf = function (t) {
      return Array.prototype.indexOf.call(this.childNodes, t);
    });
  var e = "_dynalist_ctx";
  (Element.prototype.getCtx = function () {
    return this[e];
  }),
    (Element.prototype.hasCtx = function () {
      return bool(this[e]);
    }),
    (Element.prototype.setCtx = function (t) {
      this[e] = t;
    }),
    (Element.prototype.addClass = function () {
      for (var t = [], e = 0; e < arguments.length; e++) t[e] = arguments[e];
      return this.addClasses(t), this;
    }),
    (Element.prototype.addClasses = function (t) {
      for (var e = 0; e < t.length; e++) this.classList.add(t[e]);
      return this;
    }),
    (Element.prototype.removeClass = function () {
      for (var t = [], e = 0; e < arguments.length; e++) t[e] = arguments[e];
      return this.removeClasses(t), this;
    }),
    (Element.prototype.removeClasses = function (t) {
      for (var e = 0; e < t.length; e++) this.classList.remove(t[e]);
      return this;
    }),
    (Element.prototype.toggleClass = function (t, e) {
      return (
        t instanceof Array || (t = [t]),
        e ? this.addClasses(t) : this.removeClasses(t),
        this
      );
    }),
    (Element.prototype.hasClass = function (t) {
      return this.classList.contains(t);
    }),
    (Element.prototype.setAttr = function (t, e) {
      this.setAttribute(t, String(e));
    }),
    (Element.prototype.setAttrs = function (t) {
      for (var e in t) t.hasOwnProperty(e) && this.setAttr(e, t[e]);
    }),
    (Element.prototype.getAttr = Element.prototype.getAttribute),
    HTMLElement.prototype.show ||
      (HTMLElement.prototype.show = function () {
        return (
          "none" === this.style.display &&
            ((this.style.display = this.getAttribute("data-display") || ""),
            this.removeAttribute("data-display")),
          this
        );
      }),
    HTMLElement.prototype.hide ||
      (HTMLElement.prototype.hide = function () {
        var t = this.style.display;
        return (
          "none" !== t &&
            ((this.style.display = "none"),
            t
              ? this.setAttribute("data-display", t)
              : this.removeAttribute("data-display")),
          this
        );
      }),
    HTMLElement.prototype.visible ||
      Object.defineProperty(HTMLElement.prototype, "visible", {
        get: function () {
          return null !== this.offsetParent;
        },
      }),
    (Element.prototype.uShow = function () {
      this.removeClass("u-hidden");
    }),
    (Element.prototype.uHide = function () {
      this.addClass("u-hidden");
    }),
    (Element.prototype.uToggle = function (t) {
      this.toggleClass("u-hidden", !t);
    }),
    (window.fish = function (t) {
      return document.querySelector(t);
    }),
    (window.fishAll = function (t) {
      return Array.prototype.slice.call(document.querySelectorAll(t));
    }),
    (Element.prototype.find = function (t) {
      return this.querySelector(t);
    }),
    (Element.prototype.findAll = function (t) {
      return Array.prototype.slice.call(this.querySelectorAll(t));
    }),
    (Node.prototype.createEl = function (t, e, n) {
      return ((e = e || {}).parent = this), createEl(t, e, n);
    }),
    (window.createEl = function t(e, n, r) {
      var i = n || {},
        o = i.cls,
        s = i.text,
        a = i.attr,
        c = i.title,
        u = i.value,
        h = i.type,
        d = i.parent,
        l = document.createElement(e);
      return (
        o &&
          (Array.isArray(o) ? (l.className = o.join(" ")) : (l.className = o)),
        s && l.setText(s),
        a && l.setAttrs(a),
        c && (l.title = c),
        u &&
          (l instanceof HTMLInputElement ||
            l instanceof HTMLSelectElement ||
            l instanceof HTMLOptionElement) &&
          (l.value = u),
        h && l instanceof HTMLInputElement && (l.type = h),
        r && r(l),
        d && d.appendChild(l),
        l
      );
    });
  var t = function (t, n, r, e) {
      var i = this._DYNALIST_EVENTS;
      i || ((i = {}), (this._DYNALIST_EVENTS = i));
      var o = i[t];
      o || ((o = []), (i[t] = o));
      var s = function (t) {
        var e = (function t(e, n, r) {
          return e
            ? e.matches(n)
              ? e
              : e === r
              ? null
              : t(e.parentElement, n, r)
            : null;
        })(t.target, n, t.currentTarget);
        e && r.call(this, t, e);
      };
      o.push({ selector: n, listener: r, options: e, callback: s }),
        this.addEventListener(t, s, e);
    },
    n = function (n, r, i, o) {
      var s = this,
        t = this._DYNALIST_EVENTS;
      if (t) {
        var e = t[n];
        e &&
          (t[n] = e.filter(function (t) {
            if (t.selector !== r || t.listener !== i || t.options !== o)
              return !0;
            var e = t.callback;
            return s.removeEventListener(n, e, o), !1;
          }));
      }
    };
  (HTMLElement.prototype.on = t),
    (Document.prototype.on = t),
    (HTMLElement.prototype.off = n),
    (Document.prototype.off = n),
    (window.bool = function (t) {
      return !!t;
    }),
    (window.isString = function (t) {
      return "string" == typeof t || t instanceof String;
    }),
    (window.parseBool = function (t) {
      return "false" !== t && 0 !== t && ("true" === t || bool(t));
    }),
    (window.clone_arguments = function (t) {
      for (var e = t.length, n = [], r = 0; r < e; r++) n.push(t[r]);
      return n;
    }),
    (window.isArrayLike = function (t) {
      return (
        Array.isArray(t) ||
        (bool(t) &&
          "object" == typeof t &&
          "number" == typeof t.length &&
          (0 === t.length || 0 < t.length))
      );
    }),
    (window.each = function (t, e, n, r) {
      if (isArrayLike(t)) {
        if (r) {
          for (var i = t.length - 1; 0 <= i; i--)
            if (!1 === e.call(n, t[i], i, t)) return !1;
        } else
          for (i = 0; i < t.length; i++)
            if (!1 === e.call(n, t[i], i, t)) return !1;
      } else if (t instanceof Object)
        for (var o in t)
          if (t.hasOwnProperty(o) && !1 === e.call(n, t[o], o, t)) return !1;
      return !0;
    }),
    (window.each_reverse = function (t, e, n) {
      return each(t, e, n, !0);
    }),
    (window.debounce = function (t, n, r, i, o) {
      var s = null,
        a = null,
        c = null,
        u = !1,
        h = 0,
        d = function () {
          (s = null), o && (h = Date.now()), t.apply(a, c);
        },
        l = function (t, e) {
          t && s && clearTimeout(s), (!t && s) || (s = setTimeout(d, e));
        },
        _ = function () {
          if (u) return _;
          if (!s || i) {
            (a = this), (c = []);
            for (var t = 0; t < arguments.length; t++) c.push(arguments[t]);
          }
          if (o) {
            var e = Date.now();
            if (h < e - n) return (h = e), d(), _;
          }
          return l(r, n), _;
        };
      return (
        (_.cancel = function () {
          return s && (clearTimeout(s), (s = null)), _;
        }),
        (_.disable = function () {
          return (u = !0), _;
        }),
        (_.enable = function () {
          return (u = !1), _;
        }),
        (_.set_timeout = function (t) {
          return (n = t), s && l(!0, n), _;
        }),
        (_.flush = function () {
          return l(!0, 0), _;
        }),
        _
      );
    }),
    (window.log = function () {
      console.log.apply(console, arguments);
    }),
    (window.stacktrace = function (t) {
      t || (t = new Error());
      var e = Array.prototype.cloneInline.call(arguments);
      e.push(get_stacktrace(t)), console.error.apply(console, e);
    }),
    (window.assert = function (t, e, n) {
      if (!t) {
        var r = "Assert Failed";
        e && (r += ": " + e), n && (r += ": " + n), trace(r, new Error());
      }
    }),
    (window.trace = function (t, e) {
      e && (t += "\n" + get_stacktrace(e)), console.error(t);
    }),
    (window.assert_equal = function (t, e, n) {
      assert(t === e, t + " != " + e, n);
    }),
    (window.assert_not_null = function (t, e) {
      assert(null != t, t + " is null", e);
    }),
    (window.assert_not_reached = function (t) {
      assert(!1, "Should not reach here.", t);
    }),
    (window.get_stacktrace = function (t) {
      return t.stack || t.stacktrace || "";
    }),
    (window.track_error = function (t, e) {
      console.error(t);
    }),
    (window.unsafe = function (t) {
      try {
        return t();
      } catch (t) {
        track_error(t);
      }
    }),
    (window.performance && window.performance.now) ||
      (window.performance = Date),
    (window.perf = function (t, e) {
      var n = performance.now();
      if (e) for (var r = 0; r < e; r++) t();
      else t();
      var i = performance.now() - n;
      return Math.round(i);
    });
  DYNALIST.SERVER_PROTOCOL;
  var i = DYNALIST.SERVER_HOST || "dynalist.io",
    r = (DYNALIST.SERVER_URL, DYNALIST.PUSH_URL, 3),
    o = 0,
    s = 1,
    h = 6e4,
    d = "text/plain; charset=UTF-8";
  var a = (function () {
      var g = String.fromCharCode,
        n = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
        r = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",
        i = {};
      function o(t, e) {
        if (!i[t]) {
          i[t] = {};
          for (var n = 0; n < t.length; n++) i[t][t.charAt(n)] = n;
        }
        return i[t][e];
      }
      var s = {
        compressToBase64: function (t) {
          if (null == t) return "";
          for (
            var e = s._compress(t, 6, function (t) {
              return n.charAt(t);
            });
            0 < e.length % 4;

          )
            e += "=";
        },
        decompressFromBase64: function (e) {
          return null === e
            ? ""
            : "" === e
            ? null
            : s._decompress(e.length, 32, function (t) {
                return o(n, e.charAt(t));
              });
        },
        compressToUTF16: function (t) {
          return null == t
            ? ""
            : s._compress(t, 15, function (t) {
                return g(t + 32);
              }) + " ";
        },
        decompressFromUTF16: function (e) {
          return null == e
            ? ""
            : "" == e
            ? null
            : s._decompress(e.length, 16384, function (t) {
                return e.charCodeAt(t) - 32;
              });
        },
        compressToUint8Array: function (t) {
          for (
            var e = s.compress(t),
              n = new Uint8Array(2 * e.length),
              r = 0,
              i = e.length;
            r < i;
            r++
          ) {
            var o = e.charCodeAt(r);
            (n[2 * r] = o >>> 8), (n[2 * r + 1] = o % 256);
          }
          return n;
        },
        decompressFromUint8Array: function (t) {
          if (null == t) return s.decompress(t);
          for (var e = new Array(t.length / 2), n = 0, r = e.length; n < r; n++)
            e[n] = 256 * t[2 * n] + t[2 * n + 1];
          var i = [];
          return (
            e.forEach(function (t) {
              i.push(g(t));
            }),
            s.decompress(i.join(""))
          );
        },
        compressToEncodedURIComponent: function (t) {
          return null == t
            ? ""
            : s._compress(t, 6, function (t) {
                return r.charAt(t);
              });
        },
        decompressFromEncodedURIComponent: function (e) {
          return null == e
            ? ""
            : "" == e
            ? null
            : ((e = e.replace(/ /g, "+")),
              s._decompress(e.length, 32, function (t) {
                return o(r, e.charAt(t));
              }));
        },
        compress: function (t) {
          return s._compress(t, 16, function (t) {
            return g(t);
          });
        },
        _compress: function (t, e, n) {
          if (null == t) return "";
          var r,
            i,
            o,
            s = {},
            a = {},
            c = "",
            u = "",
            h = "",
            d = 2,
            l = 3,
            _ = 2,
            p = [],
            f = 0,
            g = 0;
          for (o = 0; o < t.length; o += 1)
            if (
              ((c = t.charAt(o)),
              Object.prototype.hasOwnProperty.call(s, c) ||
                ((s[c] = l++), (a[c] = !0)),
              (u = h + c),
              Object.prototype.hasOwnProperty.call(s, u))
            )
              h = u;
            else {
              if (Object.prototype.hasOwnProperty.call(a, h)) {
                if (h.charCodeAt(0) < 256) {
                  for (r = 0; r < _; r++)
                    (f <<= 1),
                      g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++;
                  for (i = h.charCodeAt(0), r = 0; r < 8; r++)
                    (f = (f << 1) | (1 & i)),
                      g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                      (i >>= 1);
                } else {
                  for (i = 1, r = 0; r < _; r++)
                    (f = (f << 1) | i),
                      g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                      (i = 0);
                  for (i = h.charCodeAt(0), r = 0; r < 16; r++)
                    (f = (f << 1) | (1 & i)),
                      g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                      (i >>= 1);
                }
                0 == --d && ((d = Math.pow(2, _)), _++), delete a[h];
              } else
                for (i = s[h], r = 0; r < _; r++)
                  (f = (f << 1) | (1 & i)),
                    g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                    (i >>= 1);
              0 == --d && ((d = Math.pow(2, _)), _++),
                (s[u] = l++),
                (h = String(c));
            }
          if ("" !== h) {
            if (Object.prototype.hasOwnProperty.call(a, h)) {
              if (h.charCodeAt(0) < 256) {
                for (r = 0; r < _; r++)
                  (f <<= 1),
                    g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++;
                for (i = h.charCodeAt(0), r = 0; r < 8; r++)
                  (f = (f << 1) | (1 & i)),
                    g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                    (i >>= 1);
              } else {
                for (i = 1, r = 0; r < _; r++)
                  (f = (f << 1) | i),
                    g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                    (i = 0);
                for (i = h.charCodeAt(0), r = 0; r < 16; r++)
                  (f = (f << 1) | (1 & i)),
                    g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                    (i >>= 1);
              }
              0 == --d && ((d = Math.pow(2, _)), _++), delete a[h];
            } else
              for (i = s[h], r = 0; r < _; r++)
                (f = (f << 1) | (1 & i)),
                  g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
                  (i >>= 1);
            0 == --d && ((d = Math.pow(2, _)), _++);
          }
          for (i = 2, r = 0; r < _; r++)
            (f = (f << 1) | (1 & i)),
              g == e - 1 ? ((g = 0), p.push(n(f)), (f = 0)) : g++,
              (i >>= 1);
          for (;;) {
            if (((f <<= 1), g == e - 1)) {
              p.push(n(f));
              break;
            }
            g++;
          }
          return p.join("");
        },
        decompress: function (e) {
          return null == e
            ? ""
            : "" == e
            ? null
            : s._decompress(e.length, 32768, function (t) {
                return e.charCodeAt(t);
              });
        },
        _decompress: function (t, e, n) {
          var r,
            i,
            o,
            s,
            a,
            c,
            u = [0, 1, 2],
            h = 4,
            d = 4,
            l = 3,
            _ = "",
            p = [],
            f = { val: n(0), position: e, index: 1 };
          for (i = 0, s = Math.pow(2, 2), a = 1; a != s; )
            (o = f.val & f.position),
              (f.position >>= 1),
              0 == f.position && ((f.position = e), (f.val = n(f.index++))),
              (i |= (0 < o ? 1 : 0) * a),
              (a <<= 1);
          switch (i) {
            case 0:
              for (i = 0, s = Math.pow(2, 8), a = 1; a != s; )
                (o = f.val & f.position),
                  (f.position >>= 1),
                  0 == f.position && ((f.position = e), (f.val = n(f.index++))),
                  (i |= (0 < o ? 1 : 0) * a),
                  (a <<= 1);
              c = g(i);
              break;
            case 1:
              for (i = 0, s = Math.pow(2, 16), a = 1; a != s; )
                (o = f.val & f.position),
                  (f.position >>= 1),
                  0 == f.position && ((f.position = e), (f.val = n(f.index++))),
                  (i |= (0 < o ? 1 : 0) * a),
                  (a <<= 1);
              c = g(i);
              break;
            case 2:
              return "";
          }
          for (r = u[3] = c, p.push(c); ; ) {
            if (f.index > t) return "";
            for (i = 0, s = Math.pow(2, l), a = 1; a != s; )
              (o = f.val & f.position),
                (f.position >>= 1),
                0 == f.position && ((f.position = e), (f.val = n(f.index++))),
                (i |= (0 < o ? 1 : 0) * a),
                (a <<= 1);
            switch ((c = i)) {
              case 0:
                for (i = 0, s = Math.pow(2, 8), a = 1; a != s; )
                  (o = f.val & f.position),
                    (f.position >>= 1),
                    0 == f.position &&
                      ((f.position = e), (f.val = n(f.index++))),
                    (i |= (0 < o ? 1 : 0) * a),
                    (a <<= 1);
                (u[d++] = g(i)), (c = d - 1), h--;
                break;
              case 1:
                for (i = 0, s = Math.pow(2, 16), a = 1; a != s; )
                  (o = f.val & f.position),
                    (f.position >>= 1),
                    0 == f.position &&
                      ((f.position = e), (f.val = n(f.index++))),
                    (i |= (0 < o ? 1 : 0) * a),
                    (a <<= 1);
                (u[d++] = g(i)), (c = d - 1), h--;
                break;
              case 2:
                return p.join("");
            }
            if ((0 == h && ((h = Math.pow(2, l)), l++), u[c])) _ = u[c];
            else {
              if (c !== d) return null;
              _ = r + r.charAt(0);
            }
            p.push(_),
              (u[d++] = r + _.charAt(0)),
              (r = _),
              0 == --h && ((h = Math.pow(2, l)), l++);
          }
        },
      };
      return s;
    })(),
    c = (function () {
      function o() {}
      return (
        (o.encode_url_query = function (t) {
          if (!t) return "";
          var e = [];
          for (var n in t)
            t.hasOwnProperty(n) &&
              t[n] &&
              (!0 === t[n]
                ? e.push(encodeURIComponent(n))
                : e.push(
                    encodeURIComponent(n) + "=" + encodeURIComponent(t[n]),
                  ));
          return e.join("&");
        }),
        (o.decode_url_query = function (t) {
          var e = {};
          if (!t || "" === t.trim()) return e;
          for (var n = t.split("&"), r = 0; r < n.length; r++) {
            var i = n[r].split("=");
            if (1 <= i.length && i[0]) {
              var o = decodeURIComponent(i[0]);
              2 === i.length ? (e[o] = decodeURIComponent(i[1])) : (e[o] = !0);
            }
          }
          return e;
        }),
        (o.decode_url = function (t) {
          t || (t = "");
          var e = t.split("#"),
            n = 1 < e.length ? e[1] : "",
            r = e[0].split("?"),
            i = 1 < r.length ? r[1] : "";
          return {
            path: r[0],
            query: o.decode_url_query(i),
            hash: o.decode_url_query(n),
          };
        }),
        o
      );
    })(),
    u = DYNALIST.SERVICES_URL || "https://dynlst.com",
    l = "/update",
    _ = 5e3,
    p = 1.5,
    f = 6e5,
    g = 3e5,
    y = 864e5,
    v = 500,
    m = 5e3,
    w = 100;
  function b() {
    return Date.now();
  }
  function k(t, e, n, r) {
    !(function t(e, n, r, i, o) {
      var s = (o = o || {}).timeout,
        a = o.contentType,
        c = o.raw,
        u = o.headers;
      c || (n = JSON.stringify(n)),
        s || (s = h),
        a || (a = d),
        $.ajax(e, {
          type: "POST",
          data: n,
          contentType: a,
          timeout: s,
          xhrFields: { withCredentials: !0 },
          processData: !1,
          headers: u,
          dataType: "json",
          success: r,
          error: i,
        });
    })(u + t, e, n, r);
  }
  function x() {
    return c.decode_url(window.location.href).query.src || null;
  }
  var A = (function () {
      function t(t) {
        (this.uid = t),
          (this.ts_diff = 0),
          (this.ts = 0),
          (this.data = []),
          (this.length = 0),
          (this.failed = 0),
          (this.working = !1),
          (this.lz = !0),
          (this.timer = null),
          (this._request_run = debounce(this.run, _));
      }
      return (
        (t.prototype.request_run = function () {
          var t = Math.pow(p, this.failed) * _;
          f < t && (t = f),
            (t = Math.floor(t)),
            this._request_run.set_timeout(t),
            this._request_run();
        }),
        (t.prototype.run = function () {
          if (0 !== this.data.length) {
            var t = b();
            this.ts < t - g ? this.refresh() : this.push();
          }
        }),
        (t.prototype.refresh = function () {
          var n = this;
          if (!this.working) {
            var r = b();
            (this.working = !0),
              k(
                l,
                {},
                function () {
                  (n.working = !1), (n.failed = 0);
                  var t = b(),
                    e = t - r;
                  (n.ts_diff = Math.floor(e / 2)), (n.ts = t), n.run();
                },
                function () {
                  (n.working = !1), n.failed++, n.request_run();
                },
              );
          }
        }),
        (t.prototype.track = function (t, e, n) {
          try {
            if (!0 === t) return void this.run();
            (e = e || {}),
              unsafe(function () {
                return (function t(e) {
                  if (e.url) {
                    e.url = window.location.href;
                    var n = unsafe(x);
                    n && (e.src = n);
                  }
                  e.referrer &&
                    ((e.referrer = document.referrer),
                    e.referrer || delete e.referrer);
                })(e);
              }),
              this.data.push({ type: t, ts: b(), data: e }),
              this.prune(),
              n ? this.run() : this.request_run();
          } catch (t) {
            track_error(t);
          }
        }),
        (t.prototype.prune = function () {
          if (!(this.data.length < v)) {
            for (
              var t = b() - y, e = 0;
              e < this.data.length && !(this.data[e].ts > t);
              e++
            );
            0 < e && this.data.splice(0, e),
              this.data.length > m && this.data.splice(0, this.data.length - m);
          }
        }),
        (t.prototype.push = function () {
          var e = this;
          if (!this.working && 0 !== this.data.length) {
            this.length = Math.min(w, this.data.length);
            var t = this.data.slice(0, this.length);
            this.lz && ((t = JSON.stringify(t)), (t = a.compressToUTF16(t)));
            var n = {
                uid: this.uid,
                ts: this.ts_diff + b(),
                lz: this.lz,
                data: t,
              },
              r = function (t) {
                (e.working = !1),
                  t
                    ? ((e.failed = 0), e.data.splice(0, e.length))
                    : (e.failed++, (e.length = 0)),
                  0 < e.data.length && e.request_run();
              };
            (this.working = !0),
              k(
                l,
                n,
                function (t) {
                  r(bool(t && t.status));
                },
                function () {
                  r(!1);
                },
              );
          }
        }),
        (t.prototype.preview = function () {
          return this.data
            .map(function (t) {
              return JSON.stringify(t);
            })
            .join("\n");
        }),
        t
      );
    })(),
    z = (function () {
      var s,
        o,
        a = window,
        c = "fulfilled",
        u = (function () {
          var e = [],
            n = 0;
          function r() {
            for (; e.length - n; ) {
              try {
                e[n]();
              } catch (t) {
                a.console && a.console.error(t);
              }
              (e[n++] = o), 1024 == n && (e.splice(0, 1024), (n = 0));
            }
          }
          var i = (function () {
            if ("undefined" == typeof MutationObserver)
              return function () {
                setTimeout(r, 0);
              };
            var t = document.createElement("div");
            return (
              new MutationObserver(r).observe(t, { attributes: !0 }),
              function () {
                t.setAttribute("a", 0);
              }
            );
          })();
          return function (t) {
            e.push(t), e.length - n == 1 && i();
          };
        })();
      function h(t) {
        if (t) {
          var e = this;
          t(
            function (t) {
              e.resolve(t);
            },
            function (t) {
              e.reject(t);
            },
          );
        }
      }
      function d(e, t) {
        if ("function" == typeof e.y)
          try {
            var n = e.y.call(o, t);
            e.p.resolve(n);
          } catch (t) {
            e.p.reject(t);
          }
        else e.p.resolve(t);
      }
      function l(e, t) {
        if ("function" == typeof e.n)
          try {
            var n = e.n.call(o, t);
            e.p.resolve(n);
          } catch (t) {
            e.p.reject(t);
          }
        else e.p.reject(t);
      }
      return (
        (h.prototype = {
          resolve: function (n) {
            if (this.state === s) {
              if (n === this)
                return this.reject(
                  new TypeError("Attempt to resolve promise with self"),
                );
              var r = this;
              if (n && ("function" == typeof n || "object" == typeof n))
                try {
                  var e = !0,
                    t = n.then;
                  if ("function" == typeof t)
                    return void t.call(
                      n,
                      function (t) {
                        e && ((e = !1), r.resolve(t));
                      },
                      function (t) {
                        e && ((e = !1), r.reject(t));
                      },
                    );
                } catch (t) {
                  return void (e && this.reject(t));
                }
              (this.state = c),
                (this.v = n),
                r.c &&
                  u(function () {
                    for (var t = 0, e = r.c.length; t < e; t++) d(r.c[t], n);
                  });
            }
          },
          reject: function (n) {
            if (this.state === s) {
              (this.state = "rejected"), (this.v = n);
              var r = this.c;
              r
                ? u(function () {
                    for (var t = 0, e = r.length; t < e; t++) l(r[t], n);
                  })
                : !h.suppressUncaughtRejectionError &&
                  a.console &&
                  a.console.log(
                    "You upset Zousan. Please catch rejections: ",
                    n,
                    n ? n.stack : null,
                  );
            }
          },
          then: function (t, e) {
            var n = new h(),
              r = { y: t, n: e, p: n };
            if (this.state === s) this.c ? this.c.push(r) : (this.c = [r]);
            else {
              var i = this.state,
                o = this.v;
              u(function () {
                i === c ? d(r, o) : l(r, o);
              });
            }
            return n;
          },
          catch: function (t) {
            return this.then(null, t);
          },
          finally: function (t) {
            return this.then(t, t);
          },
          timeout: function (t, r) {
            r = r || "Timeout";
            var i = this;
            return new h(function (e, n) {
              setTimeout(function () {
                n(Error(r));
              }, t),
                i.then(
                  function (t) {
                    e(t);
                  },
                  function (t) {
                    n(t);
                  },
                );
            });
          },
        }),
        (h.resolve = function (t) {
          var e = new h();
          return e.resolve(t), e;
        }),
        (h.reject = function (t) {
          var e = new h();
          return e.reject(t), e;
        }),
        (h.all = function (n) {
          var r = [],
            i = 0,
            o = new h();
          function t(t, e) {
            (t && "function" == typeof t.then) || (t = h.resolve(t)),
              t.then(
                function (t) {
                  (r[e] = t), ++i == n.length && o.resolve(r);
                },
                function (t) {
                  o.reject(t);
                },
              );
          }
          for (var e = 0; e < n.length; e++) t(n[e], e);
          return n.length || o.resolve(r), o;
        }),
        ((a.Zousan = h).soon = u),
        (h.cb_resolve = function (e) {
          return function (t) {
            e && e(null, t);
          };
        }),
        (h.cb_reject = function (e) {
          return function (t) {
            e && e(t);
          };
        }),
        h
      );
    })(),
    O = "web";
  DYNALIST.IS_STANDALONE_MODE &&
    ((O = "desktop"),
    window.process && window.process.platform && (O = window.process.platform)),
    (window.Zousan = z),
    (DYNALIST.PLATFORM = O);
  var T = new A(DYNALIST.SESSION.identity);
  (window.ghost = T),
    (window.__ = T.track.bind(T)),
    __("hit", { url: !0, referrer: !0 }, !0);
  var E = function (t, e) {
    return (E =
      Object.setPrototypeOf ||
      ({ __proto__: [] } instanceof Array &&
        function (t, e) {
          t.__proto__ = e;
        }) ||
      function (t, e) {
        for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]);
      })(t, e);
  };
  function S(t, e) {
    function n() {
      this.constructor = t;
    }
    E(t, e),
      (t.prototype =
        null === e ? Object.create(e) : ((n.prototype = e.prototype), new n()));
  }
  var C = (function () {
      function t(t) {
        t || (t = new N()), (this.events = t);
      }
      return (
        (t.prototype.on = function (t, e, n) {
          return this.events.on(t, e, n);
        }),
        (t.prototype.off = function (t, e) {
          this.events.off(t, e);
        }),
        (t.prototype.offref = function (t) {
          this.events.offref(t);
        }),
        (t.prototype.trigger = function (t) {
          for (var e, n = [], r = 1; r < arguments.length; r++)
            n[r - 1] = arguments[r];
          (e = this.events).trigger.apply(
            e,
            (function t() {
              for (var e = 0, n = 0, r = arguments.length; n < r; n++)
                e += arguments[n].length;
              var i = Array(e),
                o = 0;
              for (n = 0; n < r; n++)
                for (var s = arguments[n], a = 0, c = s.length; a < c; a++, o++)
                  i[o] = s[a];
              return i;
            })([t], n),
          );
        }),
        t
      );
    })(),
    N = (function () {
      function t(t) {
        (this._ = {}),
          t &&
            ((t.on = this.on.bind(this)),
            (t.off = this.off.bind(this)),
            (t.offref = this.offref.bind(this)),
            (t.trigger = this.trigger.bind(this))),
          (this.disabled = !1);
      }
      return (
        (t.prototype.on = function (t, e, n) {
          var r = this._,
            i = r[t];
          i || (r[t] = i = []);
          var o = { name: t, fn: e, ctx: n };
          return i.push(o), o;
        }),
        (t.prototype.off = function (t, e) {
          var n = this._,
            r = n[t],
            i = [];
          if (r && e)
            for (var o = 0; o < r.length; o++) r[o].fn !== e && i.push(r[o]);
          0 < i.length ? (n[t] = i) : delete n[t];
        }),
        (t.prototype.offref = function (t) {
          if (t) {
            var e = t.name,
              n = this._,
              r = n[e],
              i = [];
            if (r && t)
              for (var o = 0; o < r.length; o++) r[o] !== t && i.push(r[o]);
            i.length ? (n[e] = i) : delete n[e];
          }
        }),
        (t.prototype.trigger = function (t) {
          for (var e = [], n = 1; n < arguments.length; n++)
            e[n - 1] = arguments[n];
          if (!this.disabled) {
            var r = this._[t];
            if (r) {
              r = r.slice();
              for (var i = 0; i < r.length; i++) this.tryTrigger(r[i], e);
            }
          }
        }),
        (t.prototype.tryTrigger = function (t, e) {
          try {
            t.fn.apply(t.ctx, e);
          } catch (t) {
            setTimeout(function () {
              throw t;
            }, 0);
          }
        }),
        (t.prototype.disable_for = function (t) {
          try {
            (this.disabled = !0), t();
          } finally {
            this.disabled = !1;
          }
        }),
        t
      );
    })(),
    j = (function (n) {
      function t(t) {
        var e = n.call(this, t) || this;
        return (e.parent = null), (e.index = -1), e;
      }
      return (
        S(t, n),
        (t.prototype.get_index = function () {
          return this.index;
        }),
        (t.prototype.set_index = function (t) {
          this.index !== t &&
            ((this.index = t), this.trigger("index_change", this));
        }),
        (t.prototype.has_ancestor = function (t) {
          return (
            this.parent && (this.parent === t || this.parent.has_ancestor(t))
          );
        }),
        (t.prototype.next_ancestor = function (t) {
          return this.parent === t
            ? this
            : this.parent
            ? this.parent.next_ancestor(t)
            : void 0;
        }),
        (t.prototype.has_parent = function () {
          return bool(this.parent);
        }),
        (t.prototype.get_parent = function () {
          return this.parent;
        }),
        (t.prototype.detach = function () {
          this.parent && this.parent.detach_child(this);
        }),
        (t.prototype.remove = function () {
          this.parent && this.parent.detach_child(this),
            this.trigger("remove", this);
        }),
        (t.prototype.next = function () {
          if (this.parent) return this.parent.get_child(this.index + 1);
        }),
        (t.prototype.prev = function () {
          if (this.parent) return this.parent.get_child(this.index - 1);
        }),
        (t.prototype.is_first = function () {
          return 0 === this.index;
        }),
        (t.prototype.is_last = function () {
          return (
            this.has_parent() &&
            this.index === this.parent.get_children().length() - 1
          );
        }),
        t
      );
    })(C),
    D = (function () {
      function t() {
        (this.a = []), (this.b = []);
      }
      return (
        (t.prototype.enqueue = function (t) {
          this.a.push(t);
        }),
        (t.prototype.flip = function () {
          if (0 === this.b.length)
            for (var t = this.a.length - 1; 0 <= t; t--)
              this.b.push(this.a.pop());
        }),
        (t.prototype.dequeue = function () {
          if (!this.empty) return this.flip(), this.b.pop();
        }),
        Object.defineProperty(t.prototype, "empty", {
          get: function () {
            return 0 === this.length;
          },
          enumerable: !0,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "length", {
          get: function () {
            return this.a.length + this.b.length;
          },
          enumerable: !0,
          configurable: !0,
        }),
        t
      );
    })();
  function M(t) {
    return null !== t && ("string" == typeof t || t instanceof String);
  }
  function I(t, e) {
    return t === e ? 0 : !t || t < e ? -1 : 1;
  }
  function q(t, e, n) {
    return (t ? U : L)(e, n);
  }
  function L(t, e) {
    t instanceof Array || (t = [t]);
    for (var n = [], r = t.length - 1; 0 <= r; r--) n.push(t[r]);
    for (; 0 < n.length; ) {
      var i = e(n.pop());
      if (!1 === i) return;
      if (i && i instanceof Array)
        for (r = i.length - 1; 0 <= r; r--) n.push(i[r]);
    }
  }
  function U(t, e) {
    t instanceof Array || (t = [t]);
    for (var n = new D(), r = 0; r < t.length; r++) n.enqueue(t[r]);
    for (; !n.empty; ) {
      var i = e(n.dequeue());
      if (!1 === i) return;
      if (i && i instanceof Array)
        for (r = 0; r < i.length; r++) n.enqueue(i[r]);
    }
  }
  var R = /[\-\[\]\/{}()*+?.\\^$|]/g;
  var H = (function () {
      function t(t) {
        (this.parent = t), (this.children = []);
      }
      return (
        (t.prototype.get = function (t) {
          if (this._range_check(t)) return this.children[t];
        }),
        (t.prototype.set = function (t, e) {
          (e.parent = this.parent), (this.children[t] = e).set_index(t);
        }),
        (t.prototype.length = function () {
          return this.children.length;
        }),
        (t.prototype.last_index = function () {
          return this.children.length - 1;
        }),
        (t.prototype.insert = function (t, e) {
          t > this.length() && (t = this.length()),
            (e.parent = this.parent),
            this.children.splice(t, 0, e),
            this._update_index(t);
        }),
        (t.prototype.prepend = function (t) {
          this.insert(0, t);
        }),
        (t.prototype.append = function (t) {
          (t.parent = this.parent),
            this.children.push(t),
            this._update_index(this.last_index());
        }),
        (t.prototype.remove = function (t) {
          (this.children = (function t(e, n) {
            return e.filter(function (t) {
              return n != t;
            });
          })(this.children, t)),
            (t.parent = null),
            t.set_index(-1),
            this._update_index(0);
        }),
        (t.prototype.clear = function () {
          this.children = [];
        }),
        (t.prototype.array = function () {
          return this.children.slice();
        }),
        (t.prototype.each = function (t, e, n) {
          return each(this.children, t, e, n);
        }),
        (t.prototype.is_empty = function () {
          return 0 === this.children.length;
        }),
        (t.prototype.some = function (t) {
          return this.children.some(t);
        }),
        (t.prototype.every = function (t) {
          return this.children.every(t);
        }),
        (t.prototype._range_check = function (t) {
          return 0 <= t && t < this.length();
        }),
        (t.prototype._update_index = function (t) {
          for (var e = t; e < this.children.length; e++)
            this.children[e].set_index(e);
        }),
        t
      );
    })(),
    Y = (function (n) {
      function t(t) {
        var e = n.call(this, t) || this;
        return (e.children = new H(e)), e;
      }
      return (
        S(t, n),
        (t.prototype.get_children = function () {
          return this.children;
        }),
        (t.prototype.has_children = function () {
          return !this.children.is_empty();
        }),
        (t.prototype.num_children = function () {
          return this.children.length();
        }),
        (t.prototype.get_child_first = function () {
          return this.children.get(0);
        }),
        (t.prototype.get_child_last = function () {
          return this.children.get(this.children.last_index());
        }),
        (t.prototype.get_child = function (t) {
          return this.children.get(t);
        }),
        (t.prototype.attach_child = function (t, e, n) {
          if (e)
            return (
              e.detach(),
              this.children.insert(t, e),
              this.trigger("attach", e),
              e
            );
        }),
        (t.prototype.attach_child_first = function (t) {
          return this.attach_child(0, t);
        }),
        (t.prototype.attach_child_end = function (t) {
          return this.attach_child(this.children.length(), t);
        }),
        (t.prototype.detach_child = function (t) {
          return this.children.remove(t), this.trigger("detach", t, this), t;
        }),
        (t.prototype.remove = function () {
          var e = this;
          this.children.each(function (t) {
            e.detach_child(t);
          }),
            n.prototype.remove.call(this);
        }),
        t
      );
    })(j),
    P = (function (n) {
      function t(t) {
        var e = n.call(this, t) || this;
        return (e.collapsed = !1), e;
      }
      return (
        S(t, n),
        (t.prototype.is_collapsed = function () {
          return this.collapsed;
        }),
        (t.prototype.set_collapsed = function (t, e) {
          this.collapsed !== t &&
            ((this.collapsed = t), this.trigger("collapse_change", this, e));
        }),
        (t.prototype.has_visible_children = function () {
          return this.has_children() && !this.is_collapsed();
        }),
        t
      );
    })(Y);
  function F() {
    return Date.now();
  }
  function V() {
    return (function t(e) {
      return e.replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
    })(
      (function t(e) {
        return btoa(String.fromCharCode.apply(null, e));
      })(
        (function t(e) {
          for (var n = new Array(e), r = 0; r < e; )
            for (
              var i = Math.random() * Math.pow(2, 32), o = 0;
              o < 4 && r < e;
              o++
            )
              (n[r] = i % 256), (i /= 256), r++;
          return n;
        })(18),
      ),
    );
  }
  function W() {
    return "~" + V();
  }
  !(function () {
    if (!window.atob) {
      var h =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
        c = h.split("");
      (window.atob = function (t) {
        if (/(=[^=]+|={3,})$/.test(t))
          throw new Error("String contains an invalid character");
        var e = 3 & (t = t.replace(/=/g, "")).length;
        if (1 == e) throw new Error("String contains an invalid character");
        for (var n = [], r = 0, i = 0, o = t.length / 4; r < o; ++r) {
          var s = h.indexOf(t[i++] || "A"),
            a = h.indexOf(t[i++] || "A"),
            c = h.indexOf(t[i++] || "A"),
            u = h.indexOf(t[i++] || "A");
          if ((s | a | c | u) < 0)
            throw new Error("String contains an invalid character");
          (n[n.length] = 255 & ((s << 2) | (a >> 4))),
            (n[n.length] = 255 & ((a << 4) | (c >> 2))),
            (n[n.length] = 255 & ((c << 6) | u));
        }
        return String.fromCharCode.apply(null, n).substr(0, n.length + e - 4);
      }),
        (window.btoa = function (t) {
          for (var e = [], n = 0, r = 0, i = t.length / 3; n < i; ++n) {
            var o = t.charCodeAt(r++),
              s = t.charCodeAt(r++),
              a = t.charCodeAt(r++);
            if (255 < (o | s | a))
              throw new Error("String contains an invalid character");
            e[e.length] =
              c[o >> 2] +
              c[((o << 4) & 63) | (s >> 4)] +
              (isNaN(s) ? "=" : c[((s << 2) & 63) | (a >> 6)]) +
              (isNaN(s + a) ? "=" : c[63 & a]);
          }
          return e.join("");
        });
    }
  })();
  var J = "0123456789abcdef".split(""),
    B = [-2147483648, 8388608, 32768, 128],
    Z = [24, 16, 8, 0],
    X = [
      1116352408, 1899447441, 3049323471, 3921009573, 961987163, 1508970993,
      2453635748, 2870763221, 3624381080, 310598401, 607225278, 1426881987,
      1925078388, 2162078206, 2614888103, 3248222580, 3835390401, 4022224774,
      264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986,
      2554220882, 2821834349, 2952996808, 3210313671, 3336571891, 3584528711,
      113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291,
      1695183700, 1986661051, 2177026350, 2456956037, 2730485921, 2820302411,
      3259730800, 3345764771, 3516065817, 3600352804, 4094571909, 275423344,
      430227734, 506948616, 659060556, 883997877, 958139571, 1322822218,
      1537002063, 1747873779, 1955562222, 2024104815, 2227730452, 2361852424,
      2428436474, 2756734187, 3204031479, 3329325298,
    ],
    K = [],
    G = function (t) {
      var e = "string" != typeof t;
      e && t.constructor == ArrayBuffer && (t = new Uint8Array(t));
      var n,
        r,
        i,
        o,
        s,
        a,
        c,
        u,
        h,
        d,
        l,
        _,
        p,
        f,
        g,
        y,
        v,
        m,
        w,
        b,
        k = !0,
        x = !1,
        A = 0,
        z = 0,
        O = 0,
        T = t.length;
      (n = 1779033703),
        (r = 3144134277),
        (i = 1013904242),
        (o = 2773480762),
        (s = 1359893119),
        (a = 2600822924),
        (c = 528734635),
        (u = 1541459225),
        (h = 0);
      do {
        if (
          ((K[0] = h),
          (K[16] =
            K[1] =
            K[2] =
            K[3] =
            K[4] =
            K[5] =
            K[6] =
            K[7] =
            K[8] =
            K[9] =
            K[10] =
            K[11] =
            K[12] =
            K[13] =
            K[14] =
            K[15] =
              0),
          e)
        )
          for (l = z; A < T && l < 64; ++A) K[l >> 2] |= t[A] << Z[3 & l++];
        else
          for (l = z; A < T && l < 64; ++A)
            (d = t.charCodeAt(A)) < 128
              ? (K[l >> 2] |= d << Z[3 & l++])
              : (d < 2048
                  ? (K[l >> 2] |= (192 | (d >> 6)) << Z[3 & l++])
                  : (d < 55296 || 57344 <= d
                      ? (K[l >> 2] |= (224 | (d >> 12)) << Z[3 & l++])
                      : ((d =
                          65536 +
                          (((1023 & d) << 10) | (1023 & t.charCodeAt(++A)))),
                        (K[l >> 2] |= (240 | (d >> 18)) << Z[3 & l++]),
                        (K[l >> 2] |= (128 | ((d >> 12) & 63)) << Z[3 & l++])),
                    (K[l >> 2] |= (128 | ((d >> 6) & 63)) << Z[3 & l++])),
                (K[l >> 2] |= (128 | (63 & d)) << Z[3 & l++]));
        (O += l - z),
          (z = l - 64),
          A == T && ((K[l >> 2] |= B[3 & l]), ++A),
          (h = K[16]),
          T < A && l < 56 && ((K[15] = O << 3), (x = !0));
        var E = n,
          S = r,
          C = i,
          N = o,
          j = s,
          D = a,
          M = c,
          I = u;
        for (_ = 16; _ < 64; ++_)
          (p =
            (((y = K[_ - 15]) >>> 7) | (y << 25)) ^
            ((y >>> 18) | (y << 14)) ^
            (y >>> 3)),
            (f =
              (((y = K[_ - 2]) >>> 17) | (y << 15)) ^
              ((y >>> 19) | (y << 13)) ^
              (y >>> 10)),
            (K[_] = (K[_ - 16] + p + K[_ - 7] + f) << 0);
        for (b = S & C, _ = 0; _ < 64; _ += 4)
          k
            ? ((v = 704751109),
              (I = ((y = K[0] - 210244248) - 1521486534) << 0),
              (N = (y + 143694565) << 0),
              (k = !1))
            : ((p =
                ((E >>> 2) | (E << 30)) ^
                ((E >>> 13) | (E << 19)) ^
                ((E >>> 22) | (E << 10))),
              (g = (v = E & S) ^ (E & C) ^ b),
              (I =
                (N +
                  (y =
                    I +
                    (f =
                      ((j >>> 6) | (j << 26)) ^
                      ((j >>> 11) | (j << 21)) ^
                      ((j >>> 25) | (j << 7))) +
                    ((j & D) ^ (~j & M)) +
                    X[_] +
                    K[_])) <<
                0),
              (N = (y + (p + g)) << 0)),
            (p =
              ((N >>> 2) | (N << 30)) ^
              ((N >>> 13) | (N << 19)) ^
              ((N >>> 22) | (N << 10))),
            (g = (m = N & E) ^ (N & S) ^ v),
            (M =
              (C +
                (y =
                  M +
                  (f =
                    ((I >>> 6) | (I << 26)) ^
                    ((I >>> 11) | (I << 21)) ^
                    ((I >>> 25) | (I << 7))) +
                  ((I & j) ^ (~I & D)) +
                  X[_ + 1] +
                  K[_ + 1])) <<
              0),
            (p =
              (((C = (y + (p + g)) << 0) >>> 2) | (C << 30)) ^
              ((C >>> 13) | (C << 19)) ^
              ((C >>> 22) | (C << 10))),
            (g = (w = C & N) ^ (C & E) ^ m),
            (D =
              (S +
                (y =
                  D +
                  (f =
                    ((M >>> 6) | (M << 26)) ^
                    ((M >>> 11) | (M << 21)) ^
                    ((M >>> 25) | (M << 7))) +
                  ((M & I) ^ (~M & j)) +
                  X[_ + 2] +
                  K[_ + 2])) <<
              0),
            (p =
              (((S = (y + (p + g)) << 0) >>> 2) | (S << 30)) ^
              ((S >>> 13) | (S << 19)) ^
              ((S >>> 22) | (S << 10))),
            (g = (b = S & C) ^ (S & N) ^ w),
            (j =
              (E +
                (y =
                  j +
                  (f =
                    ((D >>> 6) | (D << 26)) ^
                    ((D >>> 11) | (D << 21)) ^
                    ((D >>> 25) | (D << 7))) +
                  ((D & M) ^ (~D & I)) +
                  X[_ + 3] +
                  K[_ + 3])) <<
              0),
            (E = (y + (p + g)) << 0);
        (n = (n + E) << 0),
          (r = (r + S) << 0),
          (i = (i + C) << 0),
          (o = (o + N) << 0),
          (s = (s + j) << 0),
          (a = (a + D) << 0),
          (c = (c + M) << 0),
          (u = (u + I) << 0);
      } while (!x);
      return (
        J[(n >> 28) & 15] +
        J[(n >> 24) & 15] +
        J[(n >> 20) & 15] +
        J[(n >> 16) & 15] +
        J[(n >> 12) & 15] +
        J[(n >> 8) & 15] +
        J[(n >> 4) & 15] +
        J[15 & n] +
        J[(r >> 28) & 15] +
        J[(r >> 24) & 15] +
        J[(r >> 20) & 15] +
        J[(r >> 16) & 15] +
        J[(r >> 12) & 15] +
        J[(r >> 8) & 15] +
        J[(r >> 4) & 15] +
        J[15 & r] +
        J[(i >> 28) & 15] +
        J[(i >> 24) & 15] +
        J[(i >> 20) & 15] +
        J[(i >> 16) & 15] +
        J[(i >> 12) & 15] +
        J[(i >> 8) & 15] +
        J[(i >> 4) & 15] +
        J[15 & i] +
        J[(o >> 28) & 15] +
        J[(o >> 24) & 15] +
        J[(o >> 20) & 15] +
        J[(o >> 16) & 15] +
        J[(o >> 12) & 15] +
        J[(o >> 8) & 15] +
        J[(o >> 4) & 15] +
        J[15 & o] +
        J[(s >> 28) & 15] +
        J[(s >> 24) & 15] +
        J[(s >> 20) & 15] +
        J[(s >> 16) & 15] +
        J[(s >> 12) & 15] +
        J[(s >> 8) & 15] +
        J[(s >> 4) & 15] +
        J[15 & s] +
        J[(a >> 28) & 15] +
        J[(a >> 24) & 15] +
        J[(a >> 20) & 15] +
        J[(a >> 16) & 15] +
        J[(a >> 12) & 15] +
        J[(a >> 8) & 15] +
        J[(a >> 4) & 15] +
        J[15 & a] +
        J[(c >> 28) & 15] +
        J[(c >> 24) & 15] +
        J[(c >> 20) & 15] +
        J[(c >> 16) & 15] +
        J[(c >> 12) & 15] +
        J[(c >> 8) & 15] +
        J[(c >> 4) & 15] +
        J[15 & c] +
        J[(u >> 28) & 15] +
        J[(u >> 24) & 15] +
        J[(u >> 20) & 15] +
        J[(u >> 16) & 15] +
        J[(u >> 12) & 15] +
        J[(u >> 8) & 15] +
        J[(u >> 4) & 15] +
        J[15 & u]
      );
    },
    Q = (function (o) {
      function t(t, e, n, r) {
        var i = o.call(this, t.events) || this;
        return (
          (i.userspace = t),
          (i.namespace = e),
          (i.id = n),
          (i.server_id = r),
          (i.ts = 0),
          (i.title = "Untitled"),
          i
        );
      }
      return (
        S(t, o),
        (t.prototype.get_type = function () {
          return "file";
        }),
        (t.prototype.is_root = function () {
          return this.userspace.get_root_file() === this;
        }),
        (t.prototype.get_id = function () {
          return this.id;
        }),
        (t.prototype.has_server_id = function () {
          return bool(this.server_id);
        }),
        (t.prototype.get_server_id = function () {
          return this.server_id ? this.server_id : this.id;
        }),
        (t.prototype.set_server_id = function (t) {
          if (this.server_id !== t) {
            var e = this.server_id;
            (this.server_id = t),
              this.userspace.file_change_server_id(this, e, t),
              this.userspace.trigger("file_server_id_change", this, e, t);
          }
        }),
        (t.prototype.get_title = function () {
          return this.title;
        }),
        (t.prototype.set_title = function (t) {
          bool(t) || (t = "Untitled"),
            this.title !== t &&
              ((this.title = t),
              this.userspace.trigger("file_title_change", this));
        }),
        (t.prototype.get_ts = function () {
          return this.ts;
        }),
        (t.prototype.set_ts = function (t) {
          this.ts = t;
        }),
        (t.prototype.get_namespace = function () {
          return this.namespace;
        }),
        (t.prototype.set_namespace = function (t) {
          this.namespace != t &&
            ((this.namespace = t),
            this.userspace.trigger("file_namespace_change", this, t));
        }),
        (t.prototype.set_namespace_recursive = function (t) {
          this.set_namespace(t);
        }),
        (t.prototype.is_from_root_namespace = function () {
          return this.get_namespace() === this.userspace.get_root_namespace();
        }),
        (t.prototype.is_namespace_root = function () {
          return this.get_namespace().get_root_file() === this;
        }),
        (t.prototype.contains_shared_item = function () {
          return !this.get_namespace().is_root();
        }),
        (t.prototype.is_attached = function () {
          var t = this.get_namespace(),
            e = t.get_root_file();
          if (this !== e && !this.has_ancestor(e)) return !1;
          if (t.is_root()) return !0;
          var n = t.get_linkfile();
          return !(!n || !n.has_ancestor(this.userspace.get_root_file()));
        }),
        (t.prototype.get_underlying_file = function () {
          return this;
        }),
        (t.prototype.should_show_sharing_options = function () {
          var t = !this.is_from_root_namespace() && this.is_namespace_root(),
            e = this.contains_shared_item(),
            n = this.get_namespace().get_permission();
          return (t && r <= n) || (!t && !e);
        }),
        (t.prototype.serialize = function () {
          return {
            id: this.id,
            server_id: this.server_id,
            type: this.get_type(),
            namespace_id: this.namespace.get_id(),
            title: this.title,
          };
        }),
        (t.prototype.deserialize = function (t) {
          this.set_server_id(t.server_id), this.set_title(t.title);
        }),
        (t.prototype.post_deserialize = function (t) {}),
        t
      );
    })(P),
    tt = (function (i) {
      function t(t, e, n, r) {
        return i.call(this, t, e, n, r) || this;
      }
      return (
        S(t, i),
        (t.prototype.get_type = function () {
          return "folder";
        }),
        (t.prototype.set_collapsed = function (t, e) {
          this.collapsed !== t &&
            (i.prototype.set_collapsed.call(this, t, e),
            this.userspace.trigger("folder_collapse_change", this));
        }),
        (t.prototype.set_namespace_recursive = function (e) {
          this.set_namespace(e),
            this.children.each(function (t) {
              t.set_namespace_recursive(e);
            });
        }),
        (t.prototype.contains_shared_item = function () {
          if (i.prototype.contains_shared_item.call(this)) return !0;
          var e = !1;
          return (
            this.get_children().each(function (t) {
              if (t.contains_shared_item()) return !(e = !0);
            }, this),
            e
          );
        }),
        (t.prototype.serialize = function () {
          var e = i.prototype.serialize.call(this);
          return (
            (e.collapsed = this.collapsed),
            (e.children = []),
            this.children.each(function (t) {
              e.children.push(t.get_id());
            }, this),
            e
          );
        }),
        (t.prototype.deserialize = function (t) {
          i.prototype.deserialize.call(this, t),
            this.set_collapsed(t.collapsed);
        }),
        (t.prototype.post_deserialize = function (t) {
          each(
            t.children,
            function (t) {
              this.attach_child_end(this.userspace._find_file(t, t));
            },
            this,
          );
        }),
        t
      );
    })(Q),
    et = (function (r) {
      function t(t, e) {
        var n = r.call(this, new N()) || this;
        return (
          (n.userspace = t),
          (n.id = e),
          (n.version = 0),
          (n.linkfile = null),
          (n.root_file = null),
          (n.permission = 2),
          n
        );
      }
      return (
        S(t, r),
        (t.prototype.is_root = function () {
          return this.userspace.get_root_namespace() === this;
        }),
        (t.prototype.get_id = function () {
          return this.id;
        }),
        (t.prototype.set_id = function (t) {
          if (this.id != t) {
            var e = this.id;
            (this.id = t),
              this.userspace.namespace_id_change(e, t),
              this.userspace.trigger("namespace_id_change", this, e, t);
          }
        }),
        (t.prototype.get_version = function () {
          return this.version;
        }),
        (t.prototype.set_version = function (t) {
          this.version != t &&
            ((this.version = t),
            this.userspace.trigger("namespace_version_change", this, t));
        }),
        (t.prototype.get_permission = function () {
          return this.permission;
        }),
        (t.prototype.set_permission = function (t) {
          this.permission != t &&
            ((this.permission = t),
            this.userspace.trigger("namespace_permission_change", this, t));
        }),
        (t.prototype.get_root_file = function () {
          return this.root_file;
        }),
        (t.prototype.set_root_file = function (t) {
          this.root_file != t &&
            ((this.root_file = t) && t.set_namespace_recursive(this),
            this.userspace.trigger("namespace_root_file_change", this, t));
        }),
        (t.prototype.get_linkfile = function () {
          return this.linkfile;
        }),
        (t.prototype.set_linkfile = function (t) {
          this.linkfile != t &&
            ((this.linkfile = t),
            this.userspace.trigger("namespace_linkfile_change", this));
        }),
        (t.prototype.update_children = function () {
          this.root_file && this.root_file.set_namespace_recursive(this);
        }),
        (t.prototype.serialize = function () {
          return {
            namespace_id: this.id,
            version: this.version,
            permission: this.permission,
            root_file_id: this.root_file ? this.root_file.get_id() : null,
          };
        }),
        (t.prototype.deserialize = function (t) {
          this.set_version(t.version), this.set_permission(t.permission);
        }),
        (t.prototype.post_deserialize = function (t) {
          (t.root_file_id || t.root_file_server_id) &&
            this.set_root_file(
              this.userspace._find_file(t.root_file_id, t.root_file_server_id),
            );
        }),
        (t.prototype.encode = function () {
          for (
            var o = [],
              s = [this.root_file],
              t = function () {
                var t = s.shift();
                if (!t) return "continue";
                var e = t.get_server_id(),
                  n = "";
                if (t instanceof tt) {
                  var r = [];
                  t.children.each(function (t) {
                    s.push(t), r.push(t.get_server_id());
                  }),
                    (n = r.join(","));
                }
                var i = [e, n];
                o.push(i);
              };
            0 < s.length;

          )
            t();
          return JSON.stringify(o);
        }),
        (t.prototype.hash = function () {
          return G(this.encode());
        }),
        t
      );
    })(C);
  function nt(t, e) {
    e || (e = {}), "function" == typeof e && (e = { cmp: e });
    var o,
      c =
        e.cmp &&
        ((o = e.cmp),
        function (i) {
          return function (t, e) {
            var n = { key: t, value: i[t] },
              r = { key: e, value: i[e] };
            return o(n, r);
          };
        });
    return (function t(e) {
      if (
        (e && e.toJSON && "function" == typeof e.toJSON && (e = e.toJSON()),
        void 0 !== e)
      ) {
        if ("object" != typeof e || null === e) return JSON.stringify(e);
        var n = [];
        if (Array.isArray(e)) {
          for (var r = 0; r < e.length; r++) {
            var i = t(e[r]) || JSON.stringify(null);
            n.push(i);
          }
          return "[" + n.join(",") + "]";
        }
        var o = Object.keys(e).sort(c && c(e));
        for (r = 0; r < o.length; r++) {
          var s = o[r],
            a = t(e[s]);
          a && n.push(JSON.stringify(s) + ":" + a);
        }
        return "{" + n.join(",") + "}";
      }
    })(t);
  }
  var rt = (function () {
      function e(t) {
        this.data = e.read(t);
      }
      return (
        (e.prototype.get_data = function () {
          return this.data;
        }),
        (e.prototype.put = function (t, e) {
          return e ? (this.data[t] = e) : delete this.data[t], this;
        }),
        (e.prototype.get = function (t) {
          return this.data[t];
        }),
        (e.prototype.remove = function (t) {
          return delete this.data[t], this;
        }),
        (e.prototype.set_bool = function (t, e) {
          return this.put(t, e ? 1 : 0);
        }),
        (e.prototype.get_bool = function (t) {
          return bool(this.get(t));
        }),
        (e.prototype.set_int = function (t, e) {
          return this.put(t, e);
        }),
        (e.prototype.get_int = function (t) {
          var e = this.get(t);
          return e || 0;
        }),
        (e.prototype.set_string = function (t, e) {
          return this.put(t, e);
        }),
        (e.prototype.get_string = function (t) {
          var e = this.get(t);
          return e || "";
        }),
        (e.read = function (t) {
          if (!t) return {};
          try {
            return JSON.parse(t);
          } catch (t) {
            return {};
          }
        }),
        (e.prototype.write = function () {
          return e.write(this.data);
        }),
        (e.write = function (t) {
          for (var e in t) t.hasOwnProperty(e) && !t[e] && delete t[e];
          var n = nt(t);
          return "{}" === n && (n = ""), n;
        }),
        e
      );
    })(),
    ot = (function (n) {
      function t(t) {
        var e = n.call(this, t.events) || this;
        return (e.userspace = t), e;
      }
      return (
        S(t, n),
        (t.prototype.serialize = function () {
          var e = [];
          return (
            this.children.each(function (t) {
              e.push(t.serialize());
            }),
            e
          );
        }),
        (t.prototype.deserialize = function (t) {
          var n = this;
          Array.each(this.children.array(), function (t) {
            t.detach();
          }),
            each(t, function (t) {
              var e = n.userspace.deserialize_bookmark(t);
              n.attach_child_end(e);
            });
        }),
        (t.prototype.get_id = function () {
          return "root_bookmark";
        }),
        t
      );
    })(Y),
    st = (function (i) {
      function t(t, e, n) {
        var r = i.call(this, t.events) || this;
        return (
          (r.userspace = t),
          (r.id = e),
          (r.server_id = n),
          (r.data = ""),
          (r.data_obj = new pt(r.data)),
          r
        );
      }
      return (
        S(t, i),
        (t.prototype.get_id = function () {
          return this.id;
        }),
        (t.prototype.has_server_id = function () {
          return bool(this.server_id);
        }),
        (t.prototype.get_server_id = function () {
          return this.server_id ? this.server_id : this.id;
        }),
        (t.prototype.set_server_id = function (t) {
          if (this.server_id !== t) {
            var e = this.server_id;
            (this.server_id = t),
              this.userspace.bookmark_change_server_id(this, e, t),
              this.userspace.trigger("bookmark_server_id_change", this, e, t);
          }
        }),
        (t.prototype.get_data = function () {
          return this.data;
        }),
        (t.prototype.get_data_object = function () {
          return this.data_obj;
        }),
        (t.prototype.set_data = function (t) {
          bool(t) || (t = ""),
            this.data !== t &&
              ((this.data = t),
              (this.data_obj = new pt(t)),
              this.userspace.trigger("bookmark_data_change", this));
        }),
        (t.prototype.set_edited_ts = function (t) {
          this.edited_ts = t;
        }),
        (t.prototype.get_edited_ts = function () {
          return this.edited_ts;
        }),
        (t.prototype.serialize = function () {
          return {
            id: this.id,
            server_id: this.server_id,
            ts: this.edited_ts,
            data: this.data,
          };
        }),
        (t.prototype.deserialize = function (t) {
          this.set_server_id(t.server_id),
            this.set_data(t.data),
            0 === t.ts || t.ts || (t.ts = F()),
            this.set_edited_ts(t.ts);
        }),
        (t.prototype.is_root = function () {
          return !1;
        }),
        (t.prototype.is_detached = function () {
          return -1 === this.index;
        }),
        t
      );
    })(j),
    at = "t",
    ct = "d",
    ut = "z",
    ht = "f",
    dt = "q",
    lt = "flat",
    _t = "s",
    pt = (function (e) {
      function t(t) {
        return e.call(this, t) || this;
      }
      return (
        S(t, e),
        (t.prototype.set_title = function (t) {
          return this.set_string(at, t);
        }),
        (t.prototype.get_title = function () {
          return this.get_string(at);
        }),
        (t.prototype.set_document = function (t) {
          return this.set_string(ct, t);
        }),
        (t.prototype.get_document = function () {
          return this.get_string(ct);
        }),
        (t.prototype.set_zoom = function (t) {
          return this.set_string(ut, t);
        }),
        (t.prototype.get_zoom = function () {
          return this.get_string(ut);
        }),
        (t.prototype.set_focus = function (t) {
          return this.set_string(ht, t);
        }),
        (t.prototype.get_focus = function () {
          return this.get_string(ht);
        }),
        (t.prototype.set_search_query = function (t) {
          return this.set_string(dt, t);
        }),
        (t.prototype.get_search_query = function () {
          return this.get_string(dt);
        }),
        (t.prototype.set_flat_search = function (t) {
          return this.set_bool(lt, t);
        }),
        (t.prototype.get_flat_search = function () {
          return this.get_bool(lt);
        }),
        (t.prototype.set_sort = function (t) {
          return this.set_string(_t, t);
        }),
        (t.prototype.get_sort = function () {
          return this.get_string(_t);
        }),
        (t.prototype.clone = function () {
          return new t(this.write());
        }),
        (t.prototype.set_url_manager_state = function (t) {
          var e = t.document_server_id,
            n = t.zoom_node_id,
            r = t.focus_node_id,
            i = t.search_query,
            o = t.flat,
            s = t.sort;
          this.set_document(e),
            this.set_zoom(n),
            this.set_focus(r),
            this.set_search_query(i),
            this.set_flat_search(o),
            this.set_sort(s);
        }),
        (t.prototype.convert_to_url_state = function () {
          return {
            document_server_id: this.get_document(),
            zoom_node_id: this.get_zoom(),
            focus_node_id: this.get_focus(),
            search_query: this.get_search_query(),
            flat: this.get_flat_search(),
            sort: this.get_sort(),
          };
        }),
        t
      );
    })(rt),
    ft = (function (o) {
      function t(t, e, n, r) {
        var i = o.call(this, t, e, n, r) || this;
        return (i.target_namespace = null), (i.target_namespace_id = ""), i;
      }
      return (
        S(t, o),
        (t.prototype.get_type = function () {
          return "linkfile";
        }),
        (t.prototype.contains_shared_item = function () {
          return !0;
        }),
        (t.prototype.set_target_namespace_id = function (t) {
          this.target_namespace_id = t;
        }),
        (t.prototype.set_target_namespace = function (t) {
          t !== this.get_namespace() &&
            this.target_namespace !== t &&
            (this.target_namespace && this.target_namespace.set_linkfile(null),
            (this.target_namespace = t),
            this.target_namespace && this.target_namespace.set_linkfile(this),
            this.userspace.trigger("target_namespace_change", this));
        }),
        (t.prototype.get_target_namespace = function () {
          return this.target_namespace;
        }),
        (t.prototype.get_target_namespace_id = function () {
          return this.target_namespace ? this.target_namespace.get_id() : null;
        }),
        (t.prototype.get_target_file = function () {
          return this.target_namespace
            ? this.target_namespace.get_root_file()
            : null;
        }),
        (t.prototype.get_underlying_file = function () {
          return this.get_target_file();
        }),
        (t.prototype.serialize = function () {
          var t = o.prototype.serialize.call(this);
          return (t.target_namespace_id = this.get_target_namespace_id()), t;
        }),
        (t.prototype.deserialize = function (t) {
          o.prototype.deserialize.call(this, t),
            this.set_target_namespace_id(t.target_namespace_id);
        }),
        (t.prototype.post_deserialize = function (t) {
          this.update_target_namespace();
        }),
        (t.prototype.update_target_namespace = function () {
          this.set_target_namespace(
            this.userspace.find_namespace(this.target_namespace_id),
          );
        }),
        t
      );
    })(Q);
  function gt(t) {
    return (window.EXT || {})[t];
  }
  gt("aes"), gt("localforage"), gt("scroll"), gt("saveAs");
  var yt = gt("moment"),
    vt =
      (gt("datepicker"),
      gt("timepicker"),
      window.DYNALIST.RES_PATH,
      /^\s*\d{4}-\d{2}-\d{2}\s*$/);
  function mt(t) {
    t && (t = t.replace(/\s+(\+|-)/, "$1"));
    var e = yt(t),
      n = e.valueOf();
    if (isNaN(n)) return null;
    if (2534022144e5 < n) return null;
    var r = n;
    return t.match(vt) && (r = e.add(1, "d").valueOf()), [n, r];
  }
  function wt(t, e, n, r, i) {
    var o = yt(t),
      s = kt(new Date()),
      a = kt(new Date(t)),
      c = "",
      u = Math.round((a - s) / 864e5);
    if (n)
      try {
        if ("relative" !== n) return o.format(n);
        if (r) {
          if (0 === u) return "Today";
          if (-1 === u) return "Yesterday";
          if (1 === u) return "Tomorrow";
        }
        return o.fromNow();
      } catch (t) {}
    if (0 === u) {
      if (((c = "Today"), r)) return c;
      if (i) return o.fromNow();
    } else
      u < 0
        ? 1 === (u = Math.abs(u))
          ? (c = "Yesterday")
          : u < 7 && (c = u + " days ago")
        : 1 === u
        ? (c = "Tomorrow")
        : u < 7 && (c = "In " + u + " days");
    return (
      c || (c = o.format("ddd, MMMM Do YYYY")), r ? c : c + ", " + bt(o, e)
    );
  }
  function bt(t, e) {
    var n = "";
    return (
      e
        ? (n = t.format("HH:mm"))
        : (0 === t.minute() && (n = t.format("h a")),
          n || (n = t.format("h:mm a"))),
      n
    );
  }
  function kt(t) {
    return Date.UTC(t.getFullYear(), t.getMonth(), t.getDate());
  }
  function xt(t) {
    var e = new Date(t);
    return 0 === e.getHours() && 0 === e.getMinutes() && 0 === e.getSeconds();
  }
  var At = { d: "day", w: "week", m: "month", y: "year" },
    zt = {
      1: "Mon",
      2: "Tue",
      3: "Wed",
      4: "Thu",
      5: "Fri",
      6: "Sat",
      7: "Sun",
    },
    Ot = (function () {
      function t(t, e, n, r) {
        (this.amount = t), (this.unit = e), (this.data = n), (this.reset = r);
      }
      return (
        (t.prototype.get_next_recurrence = function (t) {
          var e = this.unit,
            n = this.amount,
            r = yt(t);
          if ("d" === e) return r.add(n, "d").valueOf();
          if ("w" !== e)
            return "m" === e
              ? r.add(n, "M").valueOf()
              : "y" === e
              ? r.add(n, "y").valueOf()
              : t;
          var i = this.data;
          if (i) {
            for (var o = r.isoWeekday(), s = 0, a = 1; a <= 7; a++) {
              var c = ((o + a - 1) % 7) + 1;
              if (i.contains(c.toString())) {
                s = a;
                break;
              }
            }
            return (
              1 < n && 7 < o + s && (s += 7 * (n - 1)), r.add(s, "d").valueOf()
            );
          }
          return r.add(n, "w").valueOf();
        }),
        (t.prototype.get_markdown_string = function () {
          return this.amount.toString() + this.unit + this.data;
        }),
        (t.prototype.get_readable_recurrence_string = function (t) {
          void 0 === t && (t = !1);
          var e = t ? "Every " : "every ";
          (1 === this.amount
            ? (e += At[this.unit])
            : (e += this.amount + " " + At[this.unit] + "s"),
          "w" === this.unit && this.data) &&
            (e +=
              " on " +
              this.data
                .split("")
                .map(function (t) {
                  return zt[t];
                })
                .join(", "));
          return e;
        }),
        t
      );
    })(),
    Tt = (function () {
      function t() {}
      return (
        (t.detect_url = function (e) {
          var t = !1,
            n = !1,
            r = "";
          try {
            r = c.decode_url(e).path;
          } catch (t) {
            console.error("Failed to parse URL " + e);
          }
          return (
            (r = r.replace(/^(https?):\/\//, "")).startsWith(i) &&
              (r = r.substr(i.length)),
            ("/" === r || r.startsWith("/d/") || r.startsWith("/demo/")) &&
              (t = !0),
            (r.startsWith("/u/") || r.startsWith(i + "/u/")) && (n = !0),
            { internal_url: t, upload_url: n }
          );
        }),
        t
      );
    })(),
    Et = (function () {
      function n(t, e, n) {
        (this._string = t),
          (this.start = void 0 === e ? 0 : e),
          (this.end = void 0 === n ? t.length : n);
      }
      return (
        Object.defineProperty(n.prototype, "string", {
          get: function () {
            return this._string.substring(this.start, this.end);
          },
          enumerable: !0,
          configurable: !0,
        }),
        Object.defineProperty(n.prototype, "length", {
          get: function () {
            return this.end - this.start;
          },
          enumerable: !0,
          configurable: !0,
        }),
        (n.prototype.merge = function (t) {
          return new n(this._string, this.start, t.end);
        }),
        (n.prototype.substring = function (t, e) {
          return new n(
            this._string,
            this.start + t,
            Math.min(this.start + e, this.end),
          );
        }),
        n
      );
    })(),
    St = (function () {
      function t(t) {
        this.token = t;
      }
      return (
        (t.prototype.traverse = function (t) {
          t(this);
        }),
        (t.prototype.getText = function () {
          return "";
        }),
        t
      );
    })(),
    Ct = (function (t) {
      function e() {
        return t.call(this, null) || this;
      }
      return S(e, t), e;
    })(St),
    Nt = (function (n) {
      function r(t) {
        var e = n.call(this, r.merge_list_tokens(t)) || this;
        return (e.items = t), e;
      }
      return (
        S(r, n),
        (r.prototype.append = function (t) {
          this.items.push(t);
        }),
        (r.prototype.traverse = function (e) {
          e(this),
            this.items.forEach(function (t) {
              t.traverse(e);
            });
        }),
        (r.prototype.getText = function () {
          return this.items
            .map(function (t) {
              return t.getText();
            })
            .join("");
        }),
        (r.merge_list_tokens = function (t) {
          return t.first().token.merge(t.last().token);
        }),
        r
      );
    })(St),
    jt = (function (n) {
      function t(t) {
        var e = n.call(this, t) || this;
        return (e.text = t.string), e;
      }
      return (
        S(t, n),
        (t.prototype.append = function (t) {
          (this.token = this.token.merge(t)),
            (this.text = this.text + t.string);
        }),
        (t.prototype.getText = function () {
          return this.text;
        }),
        t
      );
    })(St),
    Dt = (function (r) {
      function t(t, e) {
        var n = r.call(this, t) || this;
        return (n.inner = e), n;
      }
      return (
        S(t, r),
        (t.prototype.traverse = function (t) {
          t(this), this.inner.traverse(t);
        }),
        (t.prototype.getText = function () {
          return this.inner.getText();
        }),
        t
      );
    })(St),
    Mt = (function (r) {
      function t(t, e) {
        var n = r.call(this, t) || this;
        return (n.latex = e.text), n;
      }
      return (
        S(t, r),
        (t.prototype.getText = function () {
          return this.latex;
        }),
        t
      );
    })(jt),
    It = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    qt = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    Lt = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    Ut = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    Rt = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    Ht = (function (n) {
      function t(t, e) {
        return n.call(this, t, e) || this;
      }
      return S(t, n), t;
    })(Dt),
    Yt = (function (s) {
      function t(t, e, n, r, i) {
        var o = s.call(this, t) || this;
        return (
          (o.text_token = e),
          (o.url_token = n),
          (o.text = r),
          (o.url = i),
          (o.override_text = null),
          o
        );
      }
      return (
        S(t, s),
        (t.prototype.getText = function () {
          return this.text;
        }),
        t
      );
    })(St),
    Pt = (function (s) {
      function t(t, e, n, r, i) {
        var o = s.call(this, t, e, n, r, i) || this;
        return (o.is_displayed = !1), (o.has_zoom_node = !1), o;
      }
      return S(t, s), t;
    })(Yt),
    Ft = (function (a) {
      function t(t, e, n, r, i, o) {
        var s = a.call(this, t, e, n, r, i) || this;
        return (s.is_upload = o), s;
      }
      return S(t, a), t;
    })(Yt);
  function Vt(t) {
    return t.match(/^[a-zA-Z0-9.+\-]+:/g)
      ? t
      : t.match(/^([a-zA-Z0-9.+\-]+:\\|\/[a-zA-Z0-9])/g)
      ? "file://" + t
      : "http://" + t;
  }
  function Wt(t, e, n) {
    var r = e.string || "Link",
      i = n.string;
    i = Vt(i);
    var o = Tt.detect_url(i),
      s = o.internal_url,
      a = o.upload_url;
    return s ? new Pt(t, e, n, r, i) : new Ft(t, e, n, r, i, a);
  }
  var Jt = (function (o) {
    function t(t, e, n, r, i) {
      return o.call(this, t, e, n, r, i) || this;
    }
    return S(t, o), t;
  })(Yt);
  function Bt(t, e, n) {
    var r = e.string || "Image",
      i = n.string;
    return (i = Vt(i)), new Jt(t, e, n, r, i);
  }
  var Zt = (function (n) {
    function t(t) {
      var e = n.call(this, t) || this;
      return (e.tag = t.string), e;
    }
    return (
      S(t, n),
      (t.prototype.get_tag = function () {
        return this.tag;
      }),
      (t.prototype.getText = function () {
        return this.tag;
      }),
      t
    );
  })(St);
  function $t(t) {
    var e = !1;
    "~" === (t = t.trim().toLowerCase()).charAt(0) &&
      ((e = !0), (t = t.substr(1).trim()));
    var n = t.match(/^([0-9]*)\s*([a-z]+)\s*(-?[0-9]*)$/);
    if (!n) return null;
    var r = parseInt(n[1]);
    (isNaN(r) || "" === n[1]) && (r = 1);
    var i = n[2];
    return ["d", "w", "m", "y"].contains(i) ? new Ot(r, i, n[3], e) : null;
  }
  var Xt = (function (o) {
    function t(t, e, n, r) {
      var i = o.call(this, t, new jt(t)) || this;
      return (
        (!n || n < e) && (n = e),
        (i.startTime = e),
        (i.endTime = n),
        (i.isAllDay = e < n && xt(e) && xt(n)),
        (i.recurrence = r),
        i
      );
    }
    return (
      S(t, o),
      (t.prototype.format = function (t, e) {
        var n = this.startTime,
          r = this.endTime,
          i = this.isAllDay,
          o = i ? 1296e5 < r - n : n < r;
        i &&
          (r = (function t(e, n) {
            return yt(e).add(n, "d").valueOf();
          })(r, -1));
        var s = wt(n, t, e, i, !o);
        return (
          o &&
            (!(function t(e, n) {
              var r = new Date(e),
                i = new Date(n);
              return (
                r.getFullYear() === i.getFullYear() &&
                r.getMonth() === i.getMonth() &&
                i.getDate() === r.getDate()
              );
            })(n, r) || e
              ? (s += " - " + wt(r, t, e, i, !1))
              : (s +=
                  " - " +
                  (function t(e, n) {
                    return bt(yt(e), n);
                  })(r, t))),
          this.recurrence
            ? s + ", " + this.recurrence.get_readable_recurrence_string()
            : s
        );
      }),
      (t.prototype.getText = function () {
        return this.token.string;
      }),
      t
    );
  })(Dt);
  var Kt = "[a-zA-Z0-9.+\\-]+://",
    Gt =
      "(" +
      [
        "#",
        "@",
        "$$",
        "__",
        "~~",
        "==",
        "**",
        "![",
        "[",
        "]",
        "!(",
        "(",
        ")",
        "\n",
        " ",
        ",",
        ";",
        ".",
        "?",
        "!",
        "`",
        "/",
        "'",
        "\\",
        ":",
      ]
        .map(function t(e) {
          return (R.lastIndex = 0), e.replace(R, "\\$&");
        })
        .join("|") +
      "|" +
      Kt +
      ")";
  var Qt,
    te,
    ee,
    ne,
    re,
    ie,
    oe,
    se,
    ae,
    ce,
    ue,
    he = (function () {
      function t(t, e, n, r) {
        (this.type = t),
          (this.index = e),
          (this.start_token = n),
          (this.matchers = r),
          (this.list = []),
          (this.data = {});
      }
      return (
        (t.prototype.append = function (t) {
          if (t) {
            t instanceof Et && (t = new jt(t));
            var e = this.list,
              n = e.length;
            if (0 < n) {
              var r = e[n - 1];
              if (r.constructor === jt && t.constructor === jt)
                return void r.append(t.token);
            }
            e.push(t);
          }
        }),
        (t.prototype.length = function () {
          return this.list.length;
        }),
        (t.prototype.finish_and_get_result = function (t) {
          var e = this.list;
          this.list = [];
          var n = this.start_token,
            r = (function t(e) {
              return 0 === e.length
                ? new Ct()
                : 1 === e.length
                ? e[0]
                : new Nt(e);
            })(e);
          return (r.token = n.merge(t)), r;
        }),
        (t.prototype.get_matchers = function () {
          return this.matchers;
        }),
        t
      );
    })(),
    de = (function () {
      function t(t, e, n) {
        (this.root_matchers = e),
          (this.stack = []),
          (this.index = 0),
          (this.token = null),
          (this.tokens = n),
          this.push_context("root", t.substring(0, 0));
      }
      return (
        (t.prototype.current_context = function () {
          return this.stack.last();
        }),
        (t.prototype.current_token = function () {
          return this.tokens[this.index];
        }),
        (t.prototype.previous_token = function () {
          return this.getToken(this.index - 1);
        }),
        (t.prototype.next_token = function () {
          return this.getToken(this.index + 1);
        }),
        (t.prototype.getToken = function (t) {
          return t < 0 || t >= this.tokens.length ? null : this.tokens[t];
        }),
        (t.prototype.append = function (t) {
          this.current_context().append(t);
        }),
        (t.prototype.finish_and_get_result = function () {
          for (var t = this.stack, e = t.length - 1; 1 <= e; e--) {
            var n = t[e];
            t[e - 1].append(n.finish_and_get_result(this.tokens.last()));
          }
          return this.stack[0].finish_and_get_result(this.tokens.last());
        }),
        (t.prototype.push_context = function (t, e, n) {
          n = n || this.root_matchers;
          var r = new he(t, this.index, e, n);
          return this.stack.push(r), r;
        }),
        (t.prototype.pop_context_and_append = function (t) {
          this.stack.pop(), this.append(t);
        }),
        (t.prototype.has_next = function () {
          return this.index < this.tokens.length;
        }),
        (t.prototype.process_next = function () {
          this.token = this.tokens[this.index];
          var t = this.current_context(),
            e = t.get_matchers().get_matcher_function(this.token)(this, t);
          void 0 === e && (e = this.index + 1), (this.index = e);
        }),
        (t.prototype.getIndex = function () {
          return this.index;
        }),
        t
      );
    })(),
    le = function (t) {
      t.append(t.token);
    },
    _e = function (t, e) {
      if ("root" !== e.type)
        return t.pop_context_and_append(t.tokens[e.index]), e.index + 1;
    },
    pe = (function () {
      function t(t, e, n) {
        (this.matcher_functions = t || {}),
          (this.regex_matcher_functions = {}),
          (this.default_matcher = e || le),
          (this.eof_matcher = n || _e);
      }
      return (
        (t.prototype.get_matcher_function = function (t) {
          var e = t.string;
          if ("" === e) return this.eof_matcher;
          if (this.matcher_functions.hasOwnProperty(e))
            return this.matcher_functions[e];
          for (var n in this.regex_matcher_functions)
            if (
              this.regex_matcher_functions.hasOwnProperty(n) &&
              new RegExp(n).test(e)
            )
              return this.regex_matcher_functions[n];
          return this.default_matcher;
        }),
        (t.prototype.add_matcher_function = function (t, e) {
          this.matcher_functions[t] = e;
        }),
        (t.prototype.add_regex_matcher_function = function (t, e) {
          this.regex_matcher_functions[t] = e;
        }),
        t
      );
    })(),
    fe = /[\\~$=`*_{}\[\]()#+\-.!]/,
    ge =
      ((oe = new pe()),
      (se = function (t) {
        var e = t.next_token();
        if (e) {
          var n = e.string.charAt(0);
          if (fe.test(n)) return t.append(t.next_token()), t.getIndex() + 2;
        }
        return le(t);
      }),
      (ce = function (t) {
        var i = function (t, e) {
            var n = e.finish_and_get_result(t.previous_token()),
              r = n.token;
            return /^\d+$/.test(r.substring(1, r.length).string)
              ? _e(t, e)
              : (t.pop_context_and_append(new Zt(n.token)), t.index);
          },
          a = ["\n", " ", ""],
          e = function (t, e) {
            var n = t.next_token(),
              r = n ? n.string : null;
            return !r || a.contains(r) ? i(t, e) : le(t);
          },
          c = new pe(
            {
              "\n": i,
              " ": i,
              "**": i,
              __: i,
              "`": i,
              "'": i,
              ":": e,
              ",": i,
              ".": e,
              "?": i,
              "!": i,
              ";": i,
              "/": i,
              "(": function (t, e) {
                return e.data.brackets++, le(t);
              },
              ")": function (t, e) {
                return 0 < e.data.brackets
                  ? (e.data.brackets--, le(t))
                  : i(t, e);
              },
            },
            null,
            i,
          );
        oe.add_matcher_function(t, function (t, e) {
          var n = !1;
          if (0 === e.length()) n = !0;
          else {
            var r = t.previous_token(),
              i = r ? r.string : null;
            (0 !== e.length() && i && !/\s+$/.test(i)) || (n = !0);
          }
          var o = t.next_token(),
            s = o ? o.string : null;
          ((s && !a.contains(s)) || (n = !1), n) &&
            (t.push_context("tag", t.current_token(), c),
            (t.current_context().data.brackets = 0));
          le(t);
        });
      }),
      (ae = function (t, n, e, r) {
        var i = function (t, e) {
            var n = e.finish_and_get_result(t.previous_token());
            t.pop_context_and_append(new r(n.token, n));
          },
          o = null;
        e && (o = new pe()).add_matcher_function(t, i),
          oe.add_matcher_function(t, function (t, e) {
            if (e.type === n) return i(t, e);
            t.push_context(n, t.next_token(), o);
          });
      })(
        "**",
        "bold",
        !(ue = function (t, n, s) {
          var r = new pe({
              "[": function (t, e) {
                e.data.brackets++, le(t);
              },
              "]": function (t, e) {
                var n = e.data;
                0 < n.brackets
                  ? (n.brackets--, le(t))
                  : ((n.title_end = t.previous_token()),
                    e.finish_and_get_result(t.previous_token()),
                    (e.matchers = i));
              },
            }),
            i = new pe(
              {
                "(": function (t, e) {
                  (e.matchers = o), (e.data.url_start = t.next_token());
                },
              },
              _e,
            ),
            o = new pe({
              "(": function (t, e) {
                e.data.brackets++, le(t);
              },
              ")": function (t, e) {
                var n = e.data;
                if (0 < n.brackets) n.brackets--, le(t);
                else {
                  if (1 !== e.length()) return _e(t, e);
                  var r = n.title_start.merge(n.title_end),
                    i = n.url_start.merge(t.previous_token());
                  e.finish_and_get_result(t.previous_token());
                  var o = e.start_token.merge(t.current_token());
                  t.pop_context_and_append(s(o, r, i));
                }
              },
            });
          oe.add_matcher_function(t, function (t) {
            var e = t.push_context(n, t.current_token(), r).data;
            (e.title_start = t.next_token()), (e.brackets = 0);
          });
        }),
        It,
      ),
      ae("__", "italics", !1, qt),
      ae("$$", "latex", !0, Mt),
      ae("~~", "strikethrough", !1, Rt),
      ae("==", "highlight", !1, Ht),
      (Qt = new pe({
        "`": function (t, e) {
          var n = e.finish_and_get_result(t.previous_token());
          t.pop_context_and_append(new Lt(n.token, n));
        },
        "\\": se,
      })),
      (te = new pe({
        "`": function (t, e) {
          var n = t.getIndex(),
            r = t.next_token() && "`" === t.next_token().string,
            i = t.getToken(n + 2),
            o = i && "`" === i.string,
            s = t.getToken(n + 3),
            a = s && "\n" === s.string;
          if (r && o) {
            var c = e.finish_and_get_result(t.previous_token());
            return (
              t.pop_context_and_append(new Ut(c.token, c)),
              a ? t.getIndex() + 4 : t.getIndex() + 3
            );
          }
          le(t);
        },
      })),
      oe.add_matcher_function("`", function (t) {
        var e = t.getIndex(),
          n = t.next_token(),
          r = n && "`" === n.string,
          i = t.getToken(e + 2),
          o = i && "`" === i.string;
        if (r && o)
          return (
            t.push_context("multilinecode", t.getToken(e + 3), te),
            t.getIndex() + 3
          );
        t.push_context("inlinecode", t.current_token(), Qt);
      }),
      ce("#"),
      ce("@"),
      ue("[", "link", Wt),
      ue("![", "image", Bt),
      (ne = new pe(
        {
          "\n": (ee = function (t, e) {
            var n = e.finish_and_get_result(t.previous_token()).token;
            t.pop_context_and_append(Wt(n, n, n)), le(t);
          }),
          " ": ee,
          "(": function (t, e) {
            return e.data.brackets++, le(t);
          },
          ")": function (t, e) {
            return 0 < e.data.brackets ? (e.data.brackets--, le(t)) : ee(t, e);
          },
        },
        null,
        ee,
      )),
      oe.add_regex_matcher_function(Kt, function (t) {
        t.push_context("url", t.current_token(), ne),
          (t.current_context().data.brackets = 0),
          le(t);
      }),
      (re = "!("),
      (ie = new pe({
        ")": function (t, e) {
          var n = e.finish_and_get_result(t.current_token());
          t.pop_context_and_append(
            (function t(e, n) {
              var r,
                i = (n.text || "").split("|"),
                o = i[0],
                s = i[1],
                a = o.split(" - "),
                c = a[0],
                u = a[1],
                h = 0,
                d = mt(c.trim());
              if (!d) return new jt(e);
              if (((r = d[0]), (h = d[1]), u)) {
                var l = mt(u.trim());
                l && (h = l[1]);
              }
              var _ = null;
              return s && (_ = $t(s)), new Xt(e, r, h, _);
            })(n.token, n),
          );
        },
      })),
      oe.add_matcher_function(re, function (t) {
        t.push_context("time", t.current_token(), ie);
      }),
      oe.add_matcher_function("\\", se),
      oe),
    ye = function (t) {
      for (
        var e = (function t(e) {
            for (
              var n, r = new RegExp(Gt, "g"), i = [], o = 0;
              null !== (n = r.exec(e.string));

            )
              n.index > o && i.push(e.substring(o, n.index)),
                i.push(e.substring(n.index, r.lastIndex)),
                (o = r.lastIndex);
            return (
              o < e.length && i.push(e.substring(o, e.length)),
              i.push(e.substring(e.length, e.length)),
              i
            );
          })(t),
          n = new de(t, ge, e);
        n.has_next();

      )
        n.process_next();
      return n.finish_and_get_result();
    },
    ve = (function () {
      function t() {}
      return (
        (t.parse_text = function (e) {
          try {
            if (!e) return new jt(new Et(""));
            e = e.replace(new RegExp(String.fromCharCode(160), "g"), " ");
            var t = new Et(e);
            return ye(t);
          } catch (t) {
            return console.error(t), log(e), track_error(t), new jt(new Et(e));
          }
        }),
        t
      );
    })(),
    me = (function (i) {
      function t(t, e) {
        var n = i.call(this, t.events) || this;
        return (
          (n.collection = t),
          (n.id = e),
          (n.meta = ""),
          (n.meta_obj = new Te(n.meta)),
          (n.children_loc_ids = []),
          (n.children_loc_nodes = []),
          (n.loc_id = null),
          (n.created_ts = 0),
          (n.edited_ts = 0),
          (n.attached_ts = 0),
          (n.content_parse_tree = null),
          (n.note_parse_tree = null),
          (n.sync_attempt = 0),
          n
        );
      }
      return (
        S(t, i),
        (t.prototype.get_id = function () {
          return this.id;
        }),
        (t.prototype.get_node_collection = function () {
          return this.collection;
        }),
        (t.prototype.get_meta = function () {
          return this.meta;
        }),
        (t.prototype.get_meta_object = function () {
          return this.meta_obj;
        }),
        (t.prototype.set_meta = function (t) {
          if ((bool(t) || (t = ""), this.meta !== t)) {
            this.meta;
            var e = this.meta_obj,
              n = e.get_content(),
              r = e.get_note(),
              i = this.get_content_parse_tree(),
              o = this.get_note_parse_tree();
            (this.meta = t), (this.meta_obj = new Te(t));
            var s = this.meta_obj.get_content(),
              a = this.meta_obj.get_note();
            if (
              ((this.content_parse_tree = null),
              (this.note_parse_tree = null),
              s !== n)
            ) {
              var c = {
                node: this,
                old_content: n,
                old_content_parse_tree: i,
                new_content: s,
              };
              this.collection.trigger("node_content_change", this, c);
            }
            if (a !== r) {
              c = {
                node: this,
                old_note: r,
                old_note_parse_tree: o,
                new_note: a,
              };
              this.collection.trigger("node_note_change", this, c);
            }
            this.collection.trigger("node_meta_change", this);
          }
        }),
        (t.prototype.get_content_parse_tree = function () {
          return (
            this.content_parse_tree ||
              (this.content_parse_tree = ve.parse_text(
                this.get_meta_object().get_content(),
              )),
            this.content_parse_tree
          );
        }),
        (t.prototype.get_note_parse_tree = function () {
          return (
            this.note_parse_tree ||
              (this.note_parse_tree = ve.parse_text(
                this.get_meta_object().get_note(),
              )),
            this.note_parse_tree
          );
        }),
        (t.prototype.get_clean_title = function () {
          return (
            this.get_content_parse_tree().getText() ||
            this.get_meta_object().get_content()
          );
        }),
        (t.prototype.set_created_ts = function (t) {
          this.created_ts !== t &&
            ((this.created_ts = t),
            this.collection.trigger("node_created_ts_change", this));
        }),
        (t.prototype.get_created_ts = function () {
          return this.created_ts;
        }),
        (t.prototype.set_edited_ts = function (t) {
          this.edited_ts !== t &&
            ((this.edited_ts = t),
            this.collection.trigger("node_edited_ts_change", this));
        }),
        (t.prototype.get_edited_ts = function () {
          return this.edited_ts;
        }),
        (t.prototype.set_attached_ts = function (t) {
          this.attached_ts !== t &&
            ((this.attached_ts = t),
            this.collection.trigger("node_attached_ts_change", this));
        }),
        (t.prototype.get_attached_ts = function () {
          return this.attached_ts;
        }),
        (t.prototype.set_sync_attempt = function (t) {
          this.sync_attempt = t;
        }),
        (t.prototype.is_root = function () {
          return this.collection.get_root() === this;
        }),
        (t.prototype.is_attached_to_root = function () {
          return (
            this.is_root() ||
            this.has_ancestor(this.get_node_collection().get_root())
          );
        }),
        (t.prototype.attach_child = function (t, e, n) {
          if (e && e !== this) {
            if (e.get_parent() === this) {
              if (!n && e.get_index() === t) return;
              if (e.get_loc_id() == n) return;
            }
            if (
              (n || (n = this.generate_loc_id(t)),
              e.detach(),
              (t = this.get_loc_id_index(n)),
              i.prototype.attach_child.call(this, t, e),
              e.get_parent() == this)
            ) {
              var r = this.children_loc_ids.indexOf(n);
              (this.children_loc_nodes[r] = e).loc_id = n;
            } else this.remove_loc_id(n);
          }
        }),
        (t.prototype.generate_loc_id = function (t) {
          var e = V(),
            n = this.find_available_loc_id(t);
          return (
            this.children_loc_ids.splice(n, 0, e),
            this.children_loc_nodes.splice(n, 0, null),
            e
          );
        }),
        (t.prototype.remove_loc_id = function (t) {
          var e = this.children_loc_ids.indexOf(t);
          this.children_loc_ids.splice(e, 1),
            this.children_loc_nodes.splice(e, 1);
        }),
        (t.prototype.find_available_loc_id = function (t) {
          if (t < 0) return 0;
          if (t >= this.num_children()) return this.children_loc_ids.length;
          var e = this.get_child(t).loc_id;
          return this.children_loc_ids.indexOf(e);
        }),
        (t.prototype.get_loc_id_index = function (t) {
          var e = this.get_loc_id_node_or_prev(t);
          return e
            ? e.get_loc_id() === t
              ? e.get_index()
              : e.get_index() + 1
            : 0;
        }),
        (t.prototype.get_loc_id_node_or_prev = function (t) {
          var e = this.children_loc_ids.indexOf(t);
          if (-1 === e) return null;
          for (var n = null; null === n && 0 <= e; )
            (n = this.children_loc_nodes[e]), e--;
          return n;
        }),
        (t.prototype.get_loc_id_node_or_prev_safe = function (t) {
          var e = this.get_loc_id_node_or_prev(t);
          return e || this.get_loc_id_node_or_next(t);
        }),
        (t.prototype.get_loc_id_node_or_next = function (t) {
          var e = this.children_loc_ids.indexOf(t);
          if (-1 === e) return null;
          for (var n = null; null === n && e < this.children_loc_nodes.length; )
            (n = this.children_loc_nodes[e]), e++;
          return n;
        }),
        (t.prototype.get_loc_id_node_or_next_safe = function (t) {
          var e = this.get_loc_id_node_or_next(t);
          return e || this.get_loc_id_node_or_prev(t);
        }),
        (t.prototype.attach_child_at = function (t, e) {
          var n = this.get_loc_id_index(t);
          this.attach_child(n, e, t);
        }),
        (t.prototype.get_loc_id = function () {
          return this.loc_id;
        }),
        (t.prototype.detach_child = function (t) {
          var e = this.children_loc_ids.indexOf(t.loc_id);
          (this.children_loc_nodes[e] = null),
            (t.loc_id = null),
            i.prototype.detach_child.call(this, t);
        }),
        (t.prototype.next = function () {
          return i.prototype.next.call(this);
        }),
        (t.prototype.prev = function () {
          return i.prototype.prev.call(this);
        }),
        (t.prototype.is_expired = function (t) {
          var e = Math.max(this.edited_ts, this.attached_ts) + t;
          return this.edited_ts && this.attached_ts && F() > e;
        }),
        (t.prototype.serialize = function () {
          var e = {};
          return (
            this.children.each(function (t) {
              e[t.get_loc_id()] = t.get_id();
            }),
            {
              id: this.id,
              meta: this.meta,
              collapsed: this.collapsed,
              created_ts: this.created_ts,
              edited_ts: this.edited_ts,
              attached_ts: this.attached_ts,
              sync_attempt: this.sync_attempt,
              children_loc_ids: this.children_loc_ids,
              children_by_loc_ids: e,
            }
          );
        }),
        (t.prototype.deserialize = function (t) {
          this.set_meta(t.meta),
            this.set_collapsed(t.collapsed),
            t.created_ts || 0 === t.created_ts || (t.created_ts = 0),
            t.edited_ts || 0 === t.edited_ts || (t.edited_ts = 0),
            t.attached_ts || 0 === t.attached_ts || (t.attached_ts = 0),
            this.set_created_ts(t.created_ts),
            this.set_edited_ts(t.edited_ts),
            this.set_attached_ts(t.attached_ts),
            0 !== t.sync_attempt && this.set_sync_attempt(t.sync_attempt);
        }),
        (t.prototype.post_deserialize_local = function (t) {
          t.children_loc_ids &&
            ((this.children_loc_ids = t.children_loc_ids),
            (this.children_loc_nodes = []),
            each(
              this.children_loc_ids,
              function (t) {
                this.children_loc_nodes.push(null);
              },
              this,
            )),
            t.children_by_loc_ids &&
              each(
                t.children_by_loc_ids,
                function (t, e) {
                  this.attach_child_at(e, this.collection.find_node(t));
                },
                this,
              );
        }),
        (t.prototype.post_deserialize_merge = function (e) {
          var t = this.children.array();
          each(t, function (t) {
            e.children.contains(t.get_id()) || t.detach();
          });
          var n = 0;
          each(
            e.children,
            function (t) {
              var e = this.collection.find_node(t);
              (e.get_parent() == this && e.get_index() == n) ||
                this.attach_child(n, e),
                n++;
            },
            this,
          );
        }),
        t
      );
    })(P),
    we = "c",
    be = "n",
    ke = "checkbox",
    xe = "checked",
    Ae = "heading_level",
    ze = "l",
    Oe = "cl",
    Te = (function (n) {
      function r(t) {
        var e = n.call(this, t) || this;
        return e.upgrade(), e;
      }
      return (
        S(r, n),
        (r.prototype._upgrade = function (t, e) {
          this.data[e] ||
            (this.data[t] &&
              ((this.data[e] = this.data[t]), delete this.data[t]));
        }),
        (r.prototype.upgrade = function () {}),
        (r.prototype.set_content = function (t) {
          return this.set_string(we, t);
        }),
        (r.prototype.get_content = function () {
          return this.get_string(we);
        }),
        (r.prototype.set_note = function (t) {
          return this.set_string(be, t);
        }),
        (r.prototype.get_note = function () {
          return this.get_string(be);
        }),
        (r.prototype.set_checked = function (t) {
          return this.set_bool(xe, t);
        }),
        (r.prototype.is_checked = function () {
          return this.get_bool(xe);
        }),
        (r.prototype.set_checkbox = function (t) {
          return this.set_bool(ke, t);
        }),
        (r.prototype.has_checkbox = function () {
          return this.get_bool(ke);
        }),
        (r.prototype.set_heading = function (t) {
          return this.set_int(Ae, t);
        }),
        (r.prototype.is_heading = function () {
          return bool(this.get_heading());
        }),
        (r.prototype.get_heading = function () {
          return this.get_int(Ae);
        }),
        (r.prototype.has_color_label = function () {
          return bool(this.get_color_label());
        }),
        (r.prototype.get_color_label = function () {
          return this.get_int(Oe);
        }),
        (r.prototype.set_color_label = function (t) {
          return this.set_int(Oe, t);
        }),
        (r.prototype.set_list_style = function (t) {
          return this.set_int(ze, t);
        }),
        (r.prototype.get_list_style = function () {
          return this.get_int(ze);
        }),
        (r.prototype.is_numbered_list = function () {
          return this.get_int(ze) !== o;
        }),
        (r.prototype.merge = function (t) {
          var e = new r();
          return (
            (function t() {
              for (var e = arguments, n = 1; n < e.length; n++)
                for (var r in e[n])
                  e[n].hasOwnProperty(r) && (e[0][r] = e[n][r]);
              return e[0];
            })(e.data, this.data, t.data),
            e
          );
        }),
        (r.prototype.clone = function () {
          return new r(this.write());
        }),
        r
      );
    })(rt),
    Ee = (function (e) {
      function t() {
        var t = e.call(this, new N()) || this;
        return (
          (t.nodes = {}),
          (t.size = 0),
          (t.root = t.create_node("root")),
          (t.version = 0),
          (t.user_version = 0),
          (t.available = !1),
          t
        );
      }
      return (
        S(t, e),
        (t.prototype.get_size = function () {
          return this.size;
        }),
        (t.prototype.get_root = function () {
          return this.root;
        }),
        (t.prototype.get_first_level = function () {
          return this.root.get_children().array();
        }),
        (t.prototype.is_available = function () {
          return this.available;
        }),
        (t.prototype.set_available = function (t) {
          this.available != t &&
            ((this.available = t), this.trigger("available_change"));
        }),
        (t.prototype.get_version = function () {
          return this.version;
        }),
        (t.prototype.set_version = function (t) {
          this.version = t;
        }),
        (t.prototype.get_user_version = function () {
          return this.user_version;
        }),
        (t.prototype.set_user_version = function (t) {
          this.user_version = t;
        }),
        (t.prototype.create_node = function (t) {
          void 0 === t && (t = null), (M(t) && bool(t)) || (t = V());
          var e = new me(this, t);
          return (
            (this.nodes[t] = e), this.size++, this.trigger("node_create", e), e
          );
        }),
        (t.prototype.remove_node = function (t) {
          t.remove(), delete this.nodes[t.get_id()], this.size--;
        }),
        (t.prototype.find_node = function (t) {
          return this.nodes[t];
        }),
        (t.prototype.get_nodes = function () {
          return this.nodes;
        }),
        (t.prototype.traverse_parent = function (t, e, n) {
          for (
            ;
            t && (!n || !t.is_root()) && (!(t = t.get_parent()) || !1 !== e(t));

          );
        }),
        (t.prototype.traverse_tree_bfs = function (t, e) {
          return this.traverse_tree(!0, t, e);
        }),
        (t.prototype.traverse_tree_dfs = function (t, e) {
          return this.traverse_tree(!1, t, e);
        }),
        (t.prototype.traverse_tree = function (t, e, n) {
          return (
            e || (e = this.get_root()),
            q(t, e, function (t) {
              var e = n(t);
              return (
                "break" !== e &&
                ("continue" !== e ? t.get_children().array() : void 0)
              );
            })
          );
        }),
        (t.prototype.serialize = function () {
          var e = [];
          return (
            Object.each(
              this.nodes,
              function (t) {
                e.push(t.serialize());
              },
              this,
            ),
            {
              version: this.version,
              user_version: this.user_version,
              available: this.available,
              nodes: e,
            }
          );
        }),
        (t.prototype.deserialize = function (t) {
          var e = this;
          each(t.nodes, this.deserialize_node.bind(this)),
            each(t.nodes, function (t) {
              e.find_node(t.id).post_deserialize_local(t);
            }),
            this.set_version(t.version),
            this.set_user_version(t.user_version),
            this.set_available(t.available);
        }),
        (t.prototype.merge = function (t) {
          var e = this;
          each(t.nodes, this.deserialize_node.bind(this)),
            each(t.nodes, function (t) {
              e.find_node(t.id).post_deserialize_merge(t);
            }),
            this.set_version(t.version);
        }),
        (t.prototype.deserialize_node = function (t) {
          var e = this.find_node(t.id);
          return e || (e = this.create_node(t.id)), e.deserialize(t), e;
        }),
        t
      );
    })(C),
    Se = (function (o) {
      function t(t, e, n, r) {
        var i = o.call(this, t, e, n, r) || this;
        return (
          (i.user_data = ""),
          (i.user_data_obj = new Ne(i.user_data)),
          (i.node_collection = new Ee()),
          i
        );
      }
      return (
        S(t, o),
        (t.prototype.get_type = function () {
          return "document";
        }),
        (t.prototype.get_node_collection = function () {
          return this.node_collection;
        }),
        (t.prototype.get_user_data = function () {
          return this.user_data;
        }),
        (t.prototype.get_user_data_object = function () {
          return this.user_data_obj;
        }),
        (t.prototype.set_user_data = function (t) {
          bool(t) || (t = ""),
            this.user_data !== t &&
              ((this.user_data = t),
              (this.user_data_obj = new Ne(t)),
              this.userspace.trigger("document_user_data_change", this));
        }),
        (t.prototype.serialize = function () {
          var t = o.prototype.serialize.call(this);
          return (t.user_data = this.user_data), t;
        }),
        (t.prototype.deserialize = function (t) {
          o.prototype.deserialize.call(this, t),
            this.set_user_data(t.user_data);
        }),
        t
      );
    })(Q),
    Ce = {
      SYNC_CALENDAR: "sc",
      LAST_ACCESS: "la",
      LAYOUT: "lo",
      SHOW_CHECKED: "c",
      SHOW_NOTES: "n",
      ARCHIVED: "a",
      TEXT_DIRECTION: "td",
    },
    Ne = (function (e) {
      function t(t) {
        return e.call(this, t) || this;
      }
      return (
        S(t, e),
        (t.prototype.set_sync_calendar = function (t) {
          return this.set_bool(Ce.SYNC_CALENDAR, t);
        }),
        (t.prototype.get_sync_calendar = function () {
          return this.get_bool(Ce.SYNC_CALENDAR);
        }),
        (t.prototype.set_last_access = function (t) {
          return this.set_int(Ce.LAST_ACCESS, t);
        }),
        (t.prototype.get_last_access = function () {
          return this.get_int(Ce.LAST_ACCESS);
        }),
        (t.prototype.set_layout = function (t) {
          return this.set_string(Ce.LAYOUT, t);
        }),
        (t.prototype.get_layout = function () {
          return this.get_string(Ce.LAYOUT);
        }),
        (t.prototype.setTextDirection = function (t) {
          return this.set_string(Ce.TEXT_DIRECTION, t);
        }),
        (t.prototype.getTextDirection = function () {
          return this.get_string(Ce.TEXT_DIRECTION);
        }),
        (t.prototype.set_checked_items_visibility = function (t) {
          return this.set_string(Ce.SHOW_CHECKED, t);
        }),
        (t.prototype.get_checked_items_visibility = function () {
          return this.get_string(Ce.SHOW_CHECKED);
        }),
        (t.prototype.set_notes_visibility = function (t) {
          return this.set_string(Ce.SHOW_NOTES, t);
        }),
        (t.prototype.get_notes_visibility = function () {
          return this.get_string(Ce.SHOW_NOTES);
        }),
        (t.prototype.set_archived = function (t) {
          return this.set_bool(Ce.ARCHIVED, t);
        }),
        (t.prototype.get_archived = function () {
          return this.get_bool(Ce.ARCHIVED);
        }),
        (t.prototype.clone = function () {
          return new t(this.write());
        }),
        (t.DATA_KEYS = function () {
          return Ce;
        }),
        t
      );
    })(rt),
    je = "edit",
    De = "move",
    Me = "collapse",
    Ie = "userdata",
    qe = function t(e) {
      this.action = e;
    },
    Le = (function (e) {
      function t(t) {
        return e.call(this, t) || this;
      }
      return (
        S(t, e),
        (t.deserialize = function (t, e) {
          return e.action === je
            ? Ue.deserialize(t, e)
            : e.action === De
            ? Re.deserialize(t, e)
            : null;
        }),
        t
      );
    })(qe),
    Ue = (function (i) {
      function r(t, e, n) {
        var r = i.call(this, je) || this;
        return (r.file = t), (r.titleFrom = e), (r.titleTo = n), r;
      }
      return (
        S(r, i),
        (r.prototype.apply = function () {
          this.file.set_title(this.titleTo);
        }),
        (r.prototype.revert = function () {
          this.file.set_title(this.titleFrom);
        }),
        (r.prototype.serialize = function () {
          return {
            action: this.action,
            file_id: this.file.get_id(),
            title_from: this.titleFrom,
            title_to: this.titleTo,
          };
        }),
        (r.prototype.net_serialize = function () {
          return {
            action: this.action,
            type: this.file.get_type(),
            file_id: this.file.get_server_id(),
            title: this.titleTo,
          };
        }),
        (r.deserialize = function (t, e) {
          var n = t.find_file(e.file_id);
          return n ? new r(n, e.title_from, e.title_to) : null;
        }),
        r
      );
    })(Le),
    Re = (function (s) {
      function o(t, e, n, r, i) {
        var o = s.call(this, De) || this;
        return (
          (o.file = t),
          (o.parentOld = e),
          (o.indexOld = n),
          (o.parentNew = r),
          (o.indexNew = i),
          o
        );
      }
      return (
        S(o, s),
        (o.prototype.apply = function () {
          this.attach(this.file, this.parentNew, this.indexNew);
        }),
        (o.prototype.revert = function () {
          this.attach(this.file, this.parentOld, this.indexOld);
        }),
        (o.prototype.attach = function (t, e, n) {
          e ? e.attach_child(n, t) : t.detach();
        }),
        (o.prototype.serialize_parent = function (t) {
          return t ? t.get_id() : "";
        }),
        (o.prototype.serialize = function () {
          return {
            action: this.action,
            file_id: this.file.get_id(),
            parent_old_id: this.serialize_parent(this.parentOld),
            index_old: this.indexOld,
            parent_new_id: this.serialize_parent(this.parentNew),
            index_new: this.indexNew,
          };
        }),
        (o.prototype.net_serialize_parent = function (t) {
          return t ? t.get_server_id() : "";
        }),
        (o.prototype.net_serialize = function () {
          return {
            action: this.action,
            type: this.file.get_type(),
            file_id: this.file.get_server_id(),
            parent_id: this.net_serialize_parent(this.parentNew),
            index: this.indexNew,
          };
        }),
        (o.deserialize = function (t, e) {
          var n = t.find_file(e.file_id);
          if (!n) return null;
          var r = t.find_file(e.parent_old_id),
            i = t.find_file(e.parent_new_id);
          return new o(n, r, e.index_old, i, e.index_new);
        }),
        o
      );
    })(Le),
    He = (function (i) {
      function r(t, e, n) {
        var r = i.call(this, Ie) || this;
        return (r.document = t), (r.oldUserData = e), (r.newUserData = n), r;
      }
      return (
        S(r, i),
        (r.prototype.apply = function () {
          if (this.oldUserData != this.document.get_user_data()) {
            var e = Ne.read(this.oldUserData),
              n = Ne.read(this.document.get_user_data()),
              r = Ne.read(this.newUserData);
            Object.each(Ne.DATA_KEYS(), function (t) {
              r[t] != e[t] && (n[t] = r[t]);
            }),
              (this.newUserData = Ne.write(n));
          }
          this.document.set_user_data(this.newUserData);
        }),
        (r.prototype.revert = function () {
          this.document.set_user_data(this.oldUserData);
        }),
        (r.prototype.serialize = function () {
          return {
            file_id: this.document.get_id(),
            old_user_data: this.oldUserData,
            new_user_data: this.newUserData,
          };
        }),
        (r.prototype.net_serialize = function () {
          return {
            file_id: this.document.get_server_id(),
            user_data: this.newUserData,
          };
        }),
        (r.deserialize = function (t, e) {
          var n = t.find_file(e.file_id);
          return n ? new r(n, e.old_user_data, e.new_user_data) : null;
        }),
        r
      );
    })(qe),
    Ye = (function (r) {
      function i(t, e) {
        var n = r.call(this, Me) || this;
        return (
          (n.file = t), (n.collapsed = e), n.file.set_collapsed(n.collapsed), n
        );
      }
      return (
        S(i, r),
        (i.prototype.apply = function () {}),
        (i.prototype.revert = function () {}),
        (i.prototype.serialize = function () {
          return { file_id: this.file.get_id(), collapsed: this.collapsed };
        }),
        (i.prototype.net_serialize = function () {
          return {
            file_id: this.file.get_server_id(),
            collapsed: this.collapsed,
          };
        }),
        (i.deserialize = function (t, e) {
          var n = t.find_file(e.file_id);
          return n ? new i(n, e.collapsed) : null;
        }),
        i
      );
    })(qe),
    Pe = { EDIT: "e", MOVE: "m" },
    Fe = (function (e) {
      function t(t) {
        return e.call(this, t) || this;
      }
      return (
        S(t, e),
        (t.deserialize = function (t, e) {
          return e.action === Pe.EDIT
            ? Ve.deserialize(t, e)
            : e.action === Pe.MOVE
            ? We.deserialize(t, e)
            : null;
        }),
        t
      );
    })(qe),
    Ve = (function (i) {
      function r(t, e, n) {
        var r = i.call(this, Pe.EDIT) || this;
        return (r.bookmark = t), (r.dataOld = e), (r.dataNew = n), r;
      }
      return (
        S(r, i),
        (r.prototype.apply = function () {
          this.bookmark.set_data(this.dataNew);
        }),
        (r.prototype.revert = function () {
          this.bookmark.set_data(this.dataOld);
        }),
        (r.prototype.serialize = function () {
          return {
            action: this.action,
            id: this.bookmark.get_id(),
            data_old: this.dataOld,
            data_new: this.dataNew,
          };
        }),
        (r.prototype.net_serialize = function () {
          return {
            a: this.action,
            id: this.bookmark.get_server_id(),
            d: this.dataNew,
          };
        }),
        (r.deserialize = function (t, e) {
          var n = t.find_bookmark(e.id);
          return (
            n || (n = t.create_bookmark(e.id)), new r(n, e.data_old, e.data_new)
          );
        }),
        r
      );
    })(Fe),
    We = (function (i) {
      function r(t, e, n) {
        var r = i.call(this, Pe.MOVE) || this;
        return (r.bookmark = t), (r.indexOld = e), (r.indexNew = n), r;
      }
      return (
        S(r, i),
        (r.prototype.apply = function () {
          this.indexNew < 0
            ? this.bookmark.detach()
            : this.bookmark.userspace.root_bookmark.attach_child(
                this.indexNew,
                this.bookmark,
              );
        }),
        (r.prototype.revert = function () {
          this.indexOld < 0
            ? this.bookmark.detach()
            : this.bookmark.userspace.root_bookmark.attach_child(
                this.indexOld,
                this.bookmark,
              );
        }),
        (r.prototype.serialize = function () {
          return {
            action: this.action,
            id: this.bookmark.get_id(),
            index_old: this.indexOld,
            index_new: this.indexNew,
          };
        }),
        (r.prototype.net_serialize = function () {
          return {
            a: this.action,
            id: this.bookmark.get_server_id(),
            i: this.indexNew,
          };
        }),
        (r.deserialize = function (t, e) {
          var n = t.find_bookmark(e.id);
          return (
            n || (n = t.create_bookmark(e.id)),
            new r(n, e.index_old, e.index_new)
          );
        }),
        r
      );
    })(Fe),
    Je = (function () {
      function t() {
        this.actions = [];
      }
      return (
        (t.prototype.push_action = function (t) {
          t && this.actions.push(t);
        }),
        (t.prototype.apply_all = function () {
          Array.each(this.actions, function (t) {
            t.apply();
          });
        }),
        (t.prototype.revert_all = function () {
          Array.eachReverse(this.actions, function (t) {
            t.revert();
          });
        }),
        (t.prototype.prune = function () {}),
        (t.prototype.clear_actions = function (t) {
          this.actions.splice(0, t);
        }),
        (t.prototype.get_actions = function () {
          return this.actions;
        }),
        (t.prototype.has_changes = function () {
          return 0 < this.actions.length;
        }),
        t
      );
    })(),
    Be = (function (n) {
      function t(t) {
        var e = n.call(this) || this;
        return (e.userspace = t), (e.newDocuments = []), (e.newFolders = []), e;
      }
      return (
        S(t, n),
        (t.prototype.push_new_file = function (t) {
          t instanceof Se
            ? this.newDocuments.push(t)
            : t instanceof tt
            ? this.newFolders.push(t)
            : assert_not_reached();
        }),
        (t.prototype.get_new_documents = function () {
          return this.newDocuments;
        }),
        (t.prototype.get_new_folders = function () {
          return this.newFolders;
        }),
        (t.prototype.has_changes = function () {
          return (
            n.prototype.has_changes.call(this) ||
            0 < this.newDocuments.length ||
            0 < this.newFolders.length
          );
        }),
        (t.prototype.serialize = function () {
          var e = [];
          Array.each(this.actions, function (t) {
            e.push(t.serialize());
          });
          var n = [];
          return (
            Array.each(this.newDocuments, function (t) {
              n.push(t.get_id());
            }),
            Array.each(this.newFolders, function (t) {
              n.push(t.get_id());
            }),
            { actions: e, new_files: n }
          );
        }),
        (t.prototype.deserialize = function (t) {
          var n = this;
          (this.newDocuments = []),
            (this.newFolders = []),
            (this.actions = []),
            Array.each(t.actions, function (t) {
              var e = Le.deserialize(n.userspace, t);
              e && n.actions.push(e);
            }),
            Array.each(t.new_files, function (t) {
              var e = n.userspace.find_file(t);
              n.push_new_file(e);
            });
        }),
        t
      );
    })(Je),
    Ze = (function () {
      function t(t) {
        (this.userspace = t),
          (this.bookmark_changes = new Je()),
          (this.collapse_changes = new Je()),
          (this.document_user_data_changes = new Je());
      }
      return (
        (t.prototype.serialize = function () {
          return {
            bookmark_changes: {
              actions: this.bookmark_changes.get_actions().map(function (t) {
                return t.serialize();
              }),
            },
            collapse_changes: {
              actions: this.collapse_changes.get_actions().map(function (t) {
                return t.serialize();
              }),
            },
            document_user_data_changes: {
              actions: this.document_user_data_changes
                .get_actions()
                .map(function (t) {
                  return t.serialize();
                }),
            },
          };
        }),
        (t.prototype.deserialize = function (t) {
          var e = this;
          t.bookmark_changes &&
            Array.each(t.bookmark_changes.actions, function (t) {
              e.bookmark_changes.push_action(Fe.deserialize(e.userspace, t));
            }),
            t.collapse_changes &&
              Array.each(t.collapse_changes.actions, function (t) {
                e.collapse_changes.push_action(Ye.deserialize(e.userspace, t));
              }),
            t.document_user_data_changes &&
              Array.each(t.document_user_data_changes.actions, function (t) {
                e.document_user_data_changes.push_action(
                  He.deserialize(e.userspace, t),
                );
              });
        }),
        t
      );
    })(),
    $e = (function (e) {
      function t() {
        var t = e.call(this, new N()) || this;
        return (
          (t.files = {}),
          (t.server_files = {}),
          (t.namespaces = {}),
          (t.bookmarks = {}),
          (t.server_bookmarks = {}),
          (t.root_namespace = t.create_namespace()),
          (t.root_file = t.create_folder("root_file")),
          (t.root_bookmark = new ot(t)),
          t.root_namespace.set_root_file(t.root_file),
          (t.changes = new Be(t)),
          (t.user_changes = new Ze(t)),
          (t.userspace_version = 0),
          (t.available = !1),
          t
        );
      }
      return (
        S(t, e),
        (t.prototype.get_root_namespace = function () {
          return this.root_namespace;
        }),
        (t.prototype.get_root_bookmark = function () {
          return this.root_bookmark;
        }),
        (t.prototype.create_namespace = function (t) {
          return (M(t) && bool(t)) || (t = W()), this._make_namespace(t);
        }),
        (t.prototype.find_namespace = function (t) {
          return this.namespaces[t];
        }),
        (t.prototype.find_or_create_namespace = function (t) {
          var e = this.find_namespace(t);
          return e || (e = this.create_namespace(t)), e;
        }),
        (t.prototype.get_namespaces = function () {
          return this.namespaces;
        }),
        (t.prototype.remove_namespace = function (t) {
          delete this.namespaces[t.get_id()];
        }),
        (t.prototype._make_namespace = function (t) {
          var e = new et(this, t);
          return (
            (this.namespaces[t] = e), this.trigger("namespace_create", e), e
          );
        }),
        (t.prototype.create_bookmark = function (t, e) {
          (M(t) && bool(t)) || (t = W());
          var n = new st(this, t, e);
          return (
            (this.bookmarks[n.get_id()] = n).has_server_id() &&
              (this.server_bookmarks[n.get_server_id()] = n),
            this.trigger("bookmark_create", n),
            n
          );
        }),
        (t.prototype.find_bookmark = function (t) {
          return this.bookmarks[t];
        }),
        (t.prototype.find_server_bookmark = function (t) {
          return this.server_bookmarks[t];
        }),
        (t.prototype._find_bookmark = function (t, e) {
          var n = null;
          return (
            !n && t && (n = this.find_bookmark(t)),
            !n && e && (n = this.find_server_bookmark(e)),
            n
          );
        }),
        (t.prototype.remove_bookmark = function (t) {
          t.remove(),
            delete this.bookmarks[t.get_id()],
            t.has_server_id() &&
              delete this.server_bookmarks[t.get_server_id()];
        }),
        (t.prototype.bookmark_change_server_id = function (t, e, n) {
          e && delete this.server_bookmarks[e],
            n && (this.server_bookmarks[n] = t);
        }),
        (t.prototype.get_root_file = function () {
          return this.root_file;
        }),
        (t.prototype.create_folder = function (t, e) {
          return this._make_folder(this.root_namespace, t, e);
        }),
        (t.prototype.create_document = function (t, e) {
          return this._make_document(this.root_namespace, t, e);
        }),
        (t.prototype.create_linkfile = function (t, e) {
          return this._make_linkfile(this.root_namespace, t, e);
        }),
        (t.prototype.remove_file = function (t) {
          t.remove(),
            delete this.files[t.get_id()],
            t.has_server_id() && delete this.server_files[t.get_server_id()];
        }),
        (t.prototype.find_file = function (t) {
          return this.files[t];
        }),
        (t.prototype.find_server_file = function (t) {
          return this.server_files[t];
        }),
        (t.prototype.get_files = function () {
          return this.files;
        }),
        (t.prototype.get_bookmarks = function () {
          return this.bookmarks;
        }),
        (t.prototype.get_ts = function () {
          return this.ts;
        }),
        (t.prototype.set_ts = function (t) {
          this.ts = t;
        }),
        (t.prototype.get_userspace_version = function () {
          return this.userspace_version;
        }),
        (t.prototype.set_userspace_version = function (t) {
          this.userspace_version = t;
        }),
        (t.prototype.is_available = function () {
          return this.available;
        }),
        (t.prototype.set_available = function (t) {
          this.available = t;
        }),
        (t.prototype._make_folder = function (t, e, n) {
          (M(e) && bool(e)) || (e = W());
          var r = new tt(this, t, e, n);
          return this._created_file(r), r;
        }),
        (t.prototype._make_document = function (t, e, n) {
          (M(e) && bool(e)) || (e = W());
          var r = new Se(this, t, e, n);
          return this._created_file(r), r;
        }),
        (t.prototype._make_linkfile = function (t, e, n) {
          (M(e) && bool(e)) || (e = W());
          var r = new ft(this, t, e, n);
          return this._created_file(r), r;
        }),
        (t.prototype._created_file = function (t) {
          (this.files[t.get_id()] = t).has_server_id() &&
            (this.server_files[t.get_server_id()] = t),
            this.trigger("file_create", t);
        }),
        (t.prototype.file_change_server_id = function (t, e, n) {
          e && delete this.server_files[e], n && (this.server_files[n] = t);
        }),
        (t.prototype.namespace_id_change = function (t, e) {
          (this.namespaces[e] = this.namespaces[t]), delete this.namespaces[t];
        }),
        (t.prototype._find_file = function (t, e) {
          var n = null;
          return (
            !n && t && (n = this.find_file(t)),
            !n && e && (n = this.find_server_file(e)),
            n
          );
        }),
        (t.prototype.traverse_tree_bfs = function (t, e) {
          return this.traverse_tree(!0, t, e);
        }),
        (t.prototype.traverse_tree_dfs = function (t, e) {
          return this.traverse_tree(!1, t, e);
        }),
        (t.prototype.traverse_tree = function (t, e, n) {
          return (
            e || (e = this.get_root_file()),
            q(t, e, function (t) {
              if (t instanceof ft && !(t = t.get_target_file())) return null;
              var e = n(t);
              return (
                "break" !== e &&
                ("continue" !== e
                  ? t instanceof tt
                    ? t.get_children().array()
                    : null
                  : void 0)
              );
            })
          );
        }),
        (t.prototype.serialize = function () {
          var t = this.userspace_version,
            e = this.available,
            n = this.root_namespace.get_id(),
            r = [];
          Object.each(this.namespaces, function (t) {
            r.push(t.serialize());
          });
          var i = [];
          Object.each(this.files, function (t) {
            i.push(t.serialize());
          });
          var o = this.root_bookmark.serialize();
          return {
            userspace_version: t,
            available: e,
            root_namespace_id: n,
            namespaces: r,
            files: i,
            bookmarks: o,
          };
        }),
        (t.prototype.deserialize = function (t) {
          var e = this,
            n = t.userspace_version,
            r = t.available,
            i = t.root_namespace_id,
            o = t.namespaces,
            s = t.files,
            a = t.bookmarks;
          each(
            this.files,
            function (t) {
              t.is_root() || this.remove_file(t);
            },
            this,
          ),
            assert_equal(Object.keys(this.files).length, 1),
            each(
              this.namespaces,
              function (t) {
                t.is_root() || this.remove_namespace(t);
              },
              this,
            ),
            assert_equal(Object.keys(this.namespaces).length, 1);
          var c = "";
          i && this.root_namespace.set_id(i),
            each(o, function (t) {
              t.namespace_id === i && (c = t.root_file_server_id),
                e.find_or_create_namespace(t.namespace_id).deserialize(t);
            }),
            c && this.root_file.set_server_id(c),
            each(s, function (t) {
              e.deserialize_file(t);
            }),
            each(o, function (t) {
              e.find_namespace(t.namespace_id).post_deserialize(t);
            }),
            each(s, function (t) {
              e._find_file(t.id, t.server_id).post_deserialize(t);
            }),
            this.update_linkfiles(),
            assert_equal(Object.keys(this.namespaces).length, o.length),
            this.root_bookmark.deserialize(a),
            this.set_userspace_version(n),
            this.set_available(r);
        }),
        (t.prototype.deserialize_namespaces = function (t) {
          var n = this;
          each(t, function (t) {
            var e = n.find_or_create_namespace(t.namespace_id);
            e.deserialize(t),
              each(t.files, function (t) {
                (t.namespace_id = e.get_id()), n.deserialize_file(t);
              }),
              e.post_deserialize(t),
              each(t.files, function (t) {
                n._find_file(t.id, t.server_id).post_deserialize(t);
              });
          }),
            this.update_linkfiles();
        }),
        (t.prototype.update_linkfiles = function () {
          Object.each(this.files, function (t) {
            t instanceof ft && t.update_target_namespace();
          });
        }),
        (t.prototype.deserialize_file = function (t) {
          var e = this.find_namespace(t.namespace_id),
            n = this._find_file(t.id, t.server_id);
          return (
            n
              ? n.set_namespace(e)
              : "folder" === t.type
              ? (n = this._make_folder(e, t.id, t.server_id))
              : "document" === t.type
              ? (n = this._make_document(e, t.id, t.server_id))
              : "linkfile" === t.type
              ? (n = this._make_linkfile(e, t.id, t.server_id))
              : assert_not_reached(t.type),
            n.deserialize(t),
            n
          );
        }),
        (t.prototype.deserialize_bookmark = function (t) {
          var e = this._find_bookmark(t.id, t.server_id);
          return (
            e || (e = this.create_bookmark(t.id, t.server_id)),
            e.deserialize(t),
            e
          );
        }),
        (t.prototype.deserialize_namespace = function (t) {
          var e = this._make_namespace(t.namespace_id);
          return e.deserialize(t), e.post_deserialize(t), e;
        }),
        (t.prototype.deserialize_new_share = function (t) {
          var e = this.deserialize_namespace(t.namespace);
          e.update_children(), (t.linkfile.type = "linkfile");
          var n = this.deserialize_file(t.linkfile),
            r = e.get_root_file(),
            i = r.get_index(),
            o = r.get_parent();
          return (
            r.detach(),
            o && o.attach_child(i, n),
            n.post_deserialize(t.linkfile),
            e
          );
        }),
        (t.prototype.are_all_documents_ready = function () {
          var e = !0;
          return (
            this.traverse_tree_bfs(null, function (t) {
              if (t instanceof Se) {
                if (t.get_user_data_object().get_archived()) return;
                if (!t.get_node_collection().is_available())
                  return (e = !1), "break";
              }
            }),
            e
          );
        }),
        t
      );
    })(C),
    Xe = (function () {
      function u() {
        (this.id = ""),
          (this.meta = ""),
          (this.collapsed = !1),
          (this.created_ts = 0),
          (this.edited_ts = 0),
          (this.attached_ts = 0),
          (this.children = []),
          (this.loc_ids = []),
          (this.sync_attempt = 0);
      }
      return (
        (u.prototype.serialize = function () {
          return {
            id: this.id,
            meta: this.meta,
            collapsed: this.collapsed,
            created_ts: this.created_ts,
            edited_ts: this.edited_ts,
            attached_ts: this.attached_ts,
            children: this.children,
            loc_ids: this.loc_ids,
            sync_attempt: this.sync_attempt,
          };
        }),
        (u.deserialize = function (t) {
          var e = new u();
          return (
            (e.id = t.id),
            (e.meta = t.meta),
            (e.collapsed = t.collapsed),
            (e.created_ts = t.created_ts),
            (e.edited_ts = t.edited_ts),
            (e.attached_ts = t.attached_ts),
            (e.children = t.children),
            (e.loc_ids = t.loc_ids),
            (e.sync_attempt = t.sync_attempt),
            e
          );
        }),
        (u.from_node = function (t) {
          var e = new u();
          return (
            (e.id = t.get_id()),
            (e.meta = t.get_meta()),
            (e.collapsed = t.is_collapsed()),
            (e.created_ts = t.get_created_ts()),
            (e.edited_ts = t.get_edited_ts()),
            (e.attached_ts = t.get_attached_ts()),
            (e.children = []),
            (e.loc_ids = []),
            (e.sync_attempt = t.sync_attempt),
            t.get_children().each(function (t) {
              e.children.push(t.get_id()), e.loc_ids.push(t.get_loc_id());
            }),
            e
          );
        }),
        (u.from_server = function (t) {
          var e = t.id,
            n = t.meta,
            r = t.created_ts,
            i = t.edited_ts,
            o = t.attached_ts,
            s = t.collapsed,
            a = t.children,
            c = new u();
          return (
            (c.id = e),
            (c.meta = n),
            (c.collapsed = s),
            (c.created_ts = r),
            (c.edited_ts = i),
            (c.attached_ts = o),
            (c.children = []),
            (c.loc_ids = []),
            each(a, function (t) {
              c.children.push(t), c.loc_ids.push("");
            }),
            c
          );
        }),
        u
      );
    })(),
    Ke = (function () {
      function r() {
        (this.nodes = {}), (this.root = "");
      }
      return (
        (r.prototype.add_node = function (t) {
          this.nodes[t.id] = t;
        }),
        (r.from_node_collection = function (t) {
          var n = new r();
          return (
            t.traverse_tree_bfs(null, function (t) {
              var e = Xe.from_node(t);
              n.add_node(e);
            }),
            (n.root = t.get_root().get_id()),
            n
          );
        }),
        (r.from_server_load = function (t, e) {
          var n = new r();
          return (
            each(t, function (t) {
              var e = Xe.from_server(t);
              n.add_node(e);
            }),
            (n.root = e),
            n
          );
        }),
        (r.prototype.serialize = function () {
          var e = { root: this.root, nodes: [] };
          return (
            Object.each(this.nodes, function (t) {
              e.nodes.push(t.serialize());
            }),
            e.nodes.sort(function (t, e) {
              return t.id < e.id ? -1 : t.id > e.id ? 1 : 0;
            }),
            e
          );
        }),
        (r.deserialize = function (t) {
          var e = new r();
          return (
            (e.root = t.root),
            Array.each(t.nodes, function (t) {
              e.add_node(Xe.deserialize(t));
            }),
            e
          );
        }),
        (r.prototype.encode = function () {
          for (
            var e = this, t = [], n = this.nodes[this.root], r = [n];
            0 < r.length;

          ) {
            var i = r.shift();
            if (i) {
              var o = i.meta;
              i === n && (o = ""), "{}" === o && (o = "");
              var s = [i.id, i.children.join(","), o];
              t.push(s),
                Array.each(i.children, function (t) {
                  r.push(e.nodes[t]);
                });
            }
          }
          return JSON.stringify(t);
        }),
        (r.prototype.hash = function () {
          return G(this.encode());
        }),
        r
      );
    })(),
    Ge = (function () {
      function c() {
        (this.added = []),
          (this.removed = []),
          (this.meta = []),
          (this.location = []),
          (this.collapse = []),
          (this.created = {}),
          (this.ts = Date.now());
      }
      return (
        (c.merge_diffs = function (t) {
          var n = new c(),
            e = {},
            r = {},
            i = {},
            o = {},
            s = {};
          return (
            Array.each(t, function (t) {
              Array.each(t.added, function (t) {
                e[t] = !0;
              }),
                Array.each(t.removed, function (t) {
                  r[t] = !0;
                }),
                Array.each(t.meta, function (t) {
                  var e = t.id;
                  i.hasOwnProperty(e)
                    ? (i[e].meta_new = t.meta_new)
                    : (i[e] = {
                        id: e,
                        meta_old: t.meta_old,
                        meta_new: t.meta_new,
                      });
                }),
                Array.each(t.location, function (t) {
                  var e = t.id;
                  o.hasOwnProperty(e)
                    ? ((o[e].parent_new = t.parent_new),
                      (o[e].index_new = t.index_new),
                      (o[e].loc_id_new = t.loc_id_new))
                    : (o[e] = {
                        id: e,
                        parent_old: t.parent_old,
                        index_old: t.index_old,
                        loc_id_old: t.loc_id_old,
                        parent_new: t.parent_new,
                        index_new: t.index_new,
                        loc_id_new: t.loc_id_new,
                      });
                }),
                Object.each(t.created, function (t, e) {
                  s[e] = t;
                });
            }),
            Object.each(e, function (t, e) {
              n.added.push(e);
            }),
            Object.each(r, function (t, e) {
              n.removed.push(e);
            }),
            Object.each(i, function (t) {
              n.meta.push(t);
            }),
            Object.each(o, function (t) {
              n.location.push(t);
            }),
            (n.created = s),
            n
          );
        }),
        (c.make_diff = function (t, e, p) {
          var f = new c(),
            g = t,
            y = e,
            n = {},
            r = function (t) {
              var e = t.id;
              n[e] = e;
            };
          Object.each(g.nodes, r), Object.each(y.nodes, r);
          var v = {},
            m = {};
          return (
            Object.each(n, function (t) {
              var r = g.nodes[t],
                i = y.nodes[t],
                e = void 0 !== p && i && i.sync_attempt <= p;
              if (
                (r ||
                  ((e = !1),
                  f.make_add_diff(t),
                  (r = Xe.deserialize({
                    id: t,
                    meta: "",
                    collapsed: !1,
                    children: [],
                    loc_ids: [],
                    created_ts: 0,
                    edited_ts: 0,
                    attached_ts: 0,
                    sync_attempt: 0,
                  })),
                  (f.created[t] = i.created_ts)),
                i ||
                  ((e = !1),
                  f.make_remove_diff(t),
                  (i = Xe.deserialize({
                    id: t,
                    meta: "",
                    collapsed: !1,
                    children: [],
                    loc_ids: [],
                    created_ts: 0,
                    edited_ts: 0,
                    attached_ts: 0,
                    sync_attempt: 0,
                  })),
                  (f.created[t] = r.created_ts)),
                !e)
              ) {
                r.meta !== i.meta && f.make_meta_diff(t, r.meta, i.meta),
                  r.collapsed !== i.collapsed &&
                    f.make_collapse_diff(t, r.collapsed, i.collapsed);
                var o = [],
                  s = [],
                  a = {},
                  c = {};
                Array.each(r.children, function (t, e) {
                  var n = {
                    parent: r.id,
                    id: t,
                    index: e,
                    loc_id: r.loc_ids[e],
                  };
                  o.push(n), (a[t] = n);
                }),
                  Array.each(i.children, function (t, e) {
                    var n = {
                      parent: i.id,
                      id: t,
                      index: e,
                      loc_id: i.loc_ids[e],
                    };
                    s.push(n), (c[t] = n);
                  });
                var n = [],
                  u = [];
                Array.each(o, function (t) {
                  c[t.id] ? n.push(t) : (v[t.id] = t);
                }),
                  Array.each(s, function (t) {
                    a[t.id] ? u.push(t) : (m[t.id] = t);
                  }),
                  assert_equal(
                    n.length,
                    u.length,
                    "Both lists should have equal lengths",
                  );
                for (var h = Math.min(n.length, u.length), d = 0; d < h; d++) {
                  var l = n[d],
                    _ = u[d];
                  l.id !== _.id && ((v[l.id] = l), (m[_.id] = _));
                }
              }
            }),
            Object.each(n, function (t) {
              var e = v[t],
                n = m[t];
              (e || n) &&
                (e || (e = { parent: "", index: 0, loc_id: "" }),
                n || (n = { parent: "", index: 0, loc_id: "" }),
                f.make_location_diff(
                  t,
                  e.parent,
                  n.parent,
                  e.index,
                  n.index,
                  e.loc_id,
                  n.loc_id,
                ));
            }),
            f
          );
        }),
        (c.prototype.revert = function (t) {
          this.apply(t, !0);
        }),
        (c.prototype.apply = function (h, d, t) {
          var n = this;
          void 0 === d && (d = !1), void 0 === t && (t = !1);
          var l = function (t) {
            var e = h.find_node(t);
            return (
              e ||
                ((e = h.create_node(t)),
                n.created[t] && e.set_created_ts(n.created[t])),
              e
            );
          };
          d
            ? Array.each(this.removed, function (t) {
                l(t);
              })
            : Array.each(this.added, function (t) {
                l(t);
              }),
            Array.each(this.meta, function (t) {
              var e = t.id,
                n = t.meta_old,
                r = t.meta_new,
                i = l(e);
              d ? i.set_meta(n) : i.set_meta(r);
            }),
            t && this.apply_collapse(h, d),
            Array.each(this.location, function (t) {
              var e = t.id;
              l(e).detach();
            }),
            d ? this.sort_backward() : this.sort_forward(),
            Array.each(this.location, function (t) {
              var e,
                n = t.id,
                r = t.parent_old,
                i = t.parent_new,
                o = t.index_old,
                s = t.index_new,
                a = t.loc_id_old,
                c = t.loc_id_new,
                u = l(n);
              d
                ? r && (e = h.find_node(r)) && e.attach_child(o, u, a)
                : i && (e = h.find_node(i)) && e.attach_child(s, u, c);
            });
        }),
        (c.prototype.revert_collapse = function (t) {
          this.apply_collapse(t, !0);
        }),
        (c.prototype.apply_collapse = function (o, s) {
          Array.each(this.collapse, function (t) {
            var e = t.id,
              n = t.collapse_old,
              r = t.collapse_new,
              i = o.find_node(e);
            i && (s ? i.set_collapsed(n, !0) : i.set_collapsed(r, !0));
          });
        }),
        (c.prototype.apply_timestamps = function (n) {
          var r = this;
          Array.each(this.meta, function (t) {
            var e = t.id;
            n.find_node(e).set_edited_ts(r.ts);
          }),
            Array.each(this.location, function (t) {
              var e = t.id;
              n.find_node(e).set_attached_ts(r.ts);
            });
        }),
        (c.prototype.sort_forward = function () {
          this.location.sort(function (t, e) {
            return t.parent_new !== e.parent_new
              ? I(t.parent_new, e.parent_new)
              : t.index_new - e.index_new;
          });
        }),
        (c.prototype.sort_backward = function () {
          this.location.sort(function (t, e) {
            return t.parent_old !== e.parent_old
              ? I(t.parent_old, e.parent_old)
              : t.index_old - e.index_old;
          });
        }),
        (c.prototype.has_difference = function () {
          return (
            0 <
            this.added.length +
              this.removed.length +
              this.meta.length +
              this.location.length
          );
        }),
        (c.prototype.has_collapse_difference = function () {
          return 0 < this.collapse.length;
        }),
        (c.prototype.make_add_diff = function (t) {
          this.added.push(t);
        }),
        (c.prototype.make_remove_diff = function (t) {
          this.removed.push(t);
        }),
        (c.prototype.make_meta_diff = function (t, e, n) {
          var r = { id: t };
          e && (r.meta_old = e), n && (r.meta_new = n), this.meta.push(r);
        }),
        (c.prototype.make_location_diff = function (t, e, n, r, i, o, s) {
          var a = { id: t };
          e && ((a.parent_old = e), (a.index_old = r), (a.loc_id_old = o)),
            n && ((a.parent_new = n), (a.index_new = i), (a.loc_id_new = s)),
            this.location.push(a);
        }),
        (c.prototype.make_collapse_diff = function (t, e, n) {
          var r = { id: t, collapse_old: e, collapse_new: n };
          this.collapse.push(r);
        }),
        (c.prototype.net_serialize_old = function () {
          return {
            added: this.added,
            removed: this.removed,
            meta: this.meta,
            location: this.location,
            created: this.created,
          };
        }),
        (c.prototype.net_serialize = function () {
          var o = {
              nodes: [],
              added: [],
              removed: [],
              meta: [],
              location: [],
              timestamps: [],
            },
            s = {};
          return (
            Array.each(this.added, function (t) {
              s[t] = 1;
            }),
            Array.each(this.removed, function (t) {
              s[t] = 1;
            }),
            Array.each(this.meta, function (t) {
              s[t.id] = 1;
            }),
            Array.each(this.location, function (t) {
              s[t.id] = 1;
              var e = t.parent_new;
              e && (s[e] = 1);
            }),
            Object.each(s, function (t, e) {
              o.nodes.push(e);
            }),
            o.nodes.sort(I),
            Array.each(o.nodes, function (t, e) {
              s[t] = e;
            }),
            Array.each(this.added, function (t) {
              o.added.push(s[t]);
            }),
            Array.each(this.removed, function (t) {
              o.removed.push(s[t]);
            }),
            Array.each(this.meta, function (t) {
              var e = t.id,
                n = t.meta_new;
              o.meta.push({ i: s[e], meta: n });
            }),
            Array.each(this.location, function (t) {
              var e = t.id,
                n = t.parent_new,
                r = t.index_new,
                i = -1;
              n && s.hasOwnProperty(n) && (i = s[n]),
                o.location.push({ i: s[e], parent: i, index: r });
            }),
            Object.each(this.created, function (t, e) {
              o.timestamps.push({ i: s[e], c: t });
            }),
            o
          );
        }),
        (c.prototype.net_serialize_collapse = function () {
          return this.collapse.map(function (t) {
            return { node_id: t.id, collapsed: t.collapse_new };
          });
        }),
        (c.net_deserialize = function (t, e) {
          var n = new c();
          if (
            (t.added && (n.added = t.added),
            t.removed && (n.removed = t.removed),
            t.meta && (n.meta = t.meta),
            t.location && (n.location = t.location),
            t.created && (n.created = t.created),
            e && (n.ts = e) && e < 1583645827108)
          ) {
            var a = {};
            Array.each(n.location, function (t) {
              var e = t.parent_old,
                n = t.index_old;
              if (e) {
                var r = a[e];
                r || (a[e] = r = []);
                for (var i = 0, o = 0, s = r; o < s.length; o++) {
                  s[o] <= n && i++;
                }
                0 < i && (t.index_old = n + i), r.push(n);
              }
            });
          }
          return n;
        }),
        c
      );
    })();
  (window.DYNALIST.TCollectionDiff = Ge),
    (window.DYNALIST = window.DYNALIST || {});
  var Qe = chai.assert,
    tn = function (t) {
      var e = t.create_bookmark(null, V()),
        n = new pt(null);
      return (
        n.set_title("Bookmark Title"),
        n.set_document(V()),
        n.set_zoom(V()),
        n.set_focus(V()),
        n.set_search_query("Search query"),
        e.set_data(n.write()),
        e
      );
    },
    en = function () {
      var t = Date.now(),
        e = new Ee(),
        n = e.create_node();
      n.set_meta(new Te().set_content("Top node").write()),
        n.set_created_ts(t),
        n.set_edited_ts(t),
        n.set_attached_ts(t),
        e.get_root().attach_child(0, n);
      var r = e.create_node();
      r.set_meta(new Te().set_content("Child node 1").write()),
        r.set_created_ts(t),
        r.set_edited_ts(t),
        r.set_attached_ts(t),
        n.attach_child(0, r);
      var i = e.create_node();
      i.set_meta(new Te().set_content("Child node 2").write()),
        i.set_created_ts(t),
        i.set_edited_ts(t),
        i.set_attached_ts(t),
        n.attach_child(1, i);
      var o = e.create_node();
      return (
        o.set_meta(new Te().set_content("Child node 3").write()),
        o.set_created_ts(t),
        o.set_edited_ts(t),
        o.set_attached_ts(t),
        n.attach_child(2, o),
        n.set_collapsed(!0),
        { node_collection: e, node: n, node1: r, node2: i, node3: o, now: t }
      );
    };
  describe("Userspace", function () {
    describe("Userspace", function () {
      var n = new $e(),
        t = n.create_folder(null, V());
      n.get_root_file().attach_child(0, t), t.set_title("Test folder");
      var e = n.create_document(null, V());
      t.attach_child(0, e), e.set_title("Test document");
      var r = n.create_namespace(V()),
        i = n._make_folder(r, null, V());
      r.set_root_file(i), t.set_title("Test shared folder");
      var o = n.create_linkfile(null, V());
      n.get_root_file().attach_child(3, o), o.set_target_namespace(r);
      var s = tn(n);
      n.get_root_bookmark().attach_child(0, s),
        it("Should serialize and deserialize", function () {
          var t = n.serialize(),
            e = new $e();
          e.deserialize(t), Qe.deepEqual(t, e.serialize());
        });
    }),
      describe("UserspaceChanges", function () {
        var n = new $e(),
          r = n.create_document(null, V());
        n.get_root_file().attach_child(0, r);
        var i = n.create_folder(null, V());
        n.get_root_file().attach_child(1, i);
        var o = tn(n);
        n.get_root_bookmark().attach_child(0, o),
          describe("EditUserspaceAction", function () {
            it("Should deserialize and re-serialize", function () {
              var t = {
                  action: je,
                  file_id: r.get_id(),
                  title_from: "",
                  title_to: "New title",
                },
                e = Le.deserialize(n, t);
              Qe.instanceOf(e, Ue), Qe.deepEqual(t, e.serialize());
            });
          }),
          describe("MoveUserspaceAction", function () {
            it("Should deserialize and re-serialize", function () {
              var t = {
                  action: De,
                  file_id: r.get_id(),
                  parent_old_id: "",
                  index_old: 0,
                  parent_new_id: n.get_root_file().get_id(),
                  index_new: 0,
                },
                e = Le.deserialize(n, t);
              Qe.instanceOf(e, Re), Qe.deepEqual(t, e.serialize());
            });
          }),
          describe("CollapseUserspaceAction", function () {
            it("Should deserialize and re-serialize", function () {
              var t = { file_id: i.get_id(), collapsed: !0 },
                e = Ye.deserialize(n, t);
              Qe.instanceOf(e, Ye), Qe.deepEqual(t, e.serialize());
            });
          }),
          describe("BookmarkEditAction", function () {
            it("Should deserialize and re-serialize", function () {
              var t = {
                  action: Pe.EDIT,
                  id: o.get_id(),
                  data_old: "Old data",
                  data_new: "New data",
                },
                e = Fe.deserialize(n, t);
              Qe.instanceOf(e, Ve), Qe.deepEqual(t, e.serialize());
            });
          }),
          describe("BookmarkMoveAction", function () {
            it("Should deserialize and re-serialize", function () {
              var t = {
                  action: Pe.MOVE,
                  id: o.get_id(),
                  index_old: 1,
                  index_new: 0,
                },
                e = Fe.deserialize(n, t);
              Qe.instanceOf(e, We), Qe.deepEqual(t, e.serialize());
            });
          });
      });
  }),
    describe("Node", function () {
      describe("NodeCollection", function () {
        it("Should deserialize and re-serialize", function () {
          var t = new Ee(),
            e = {
              version: 1,
              user_version: 2,
              available: !0,
              nodes: [
                {
                  id: "root",
                  meta: '{"c":"Test Document "}',
                  collapsed: !1,
                  edited_ts: 1473619565274,
                  attached_ts: 0,
                  children_loc_ids: ["tczJ2Nx9fgSIusGy5qzxIYZk"],
                  children_by_loc_ids: {
                    tczJ2Nx9fgSIusGy5qzxIYZk: "AEpQRPM4yPvKi9xR9D3A4yg2",
                  },
                  sync_attempt: 1,
                },
                {
                  id: "AEpQRPM4yPvKi9xR9D3A4yg2",
                  meta: '{"c":"Top node"}',
                  collapsed: !0,
                  edited_ts: 1473619541118,
                  attached_ts: 1473619539779,
                  children_loc_ids: [
                    "NlAnMDeKQYqS5ICfBjHNl7UU",
                    "n_lCS6WmhARShh6joqc0bVYz",
                  ],
                  children_by_loc_ids: {
                    NlAnMDeKQYqS5ICfBjHNl7UU: "QWLVMm5HRW6XXuaUCuUJr3ZZ",
                    n_lCS6WmhARShh6joqc0bVYz: "f2kLGXSH2G45WNtcVqyCBeFo",
                  },
                  sync_attempt: 1,
                },
                {
                  id: "f2kLGXSH2G45WNtcVqyCBeFo",
                  meta: '{"c":"Child node 2"}',
                  collapsed: !1,
                  edited_ts: 1473619541118,
                  attached_ts: 1473619541118,
                  children_loc_ids: [],
                  children_by_loc_ids: {},
                  sync_attempt: 1,
                },
                {
                  id: "QWLVMm5HRW6XXuaUCuUJr3ZZ",
                  meta: '{"c":"Child node"}',
                  collapsed: !1,
                  edited_ts: 1473619541118,
                  attached_ts: 1473619541118,
                  children_loc_ids: [],
                  children_by_loc_ids: {},
                  sync_attempt: 1,
                },
              ],
            };
          t.deserialize(e);
          var n = t.serialize();
          log(e, n), Qe.deepEqual(e, n);
        });
      }),
        describe("NodeMeta", function () {
          it("Should deserialize and re-serialize", function () {
            var t = nt({
                c: "Content",
                n: "Note",
                checkbox: !0,
                checked: !0,
                heading_level: 1,
                l: s,
                cl: 1,
              }),
              e = new Te(t);
            Qe.deepEqual(t, e.write());
          });
        });
      var t = en(),
        e = t.node_collection,
        n = t.node;
      describe("NodeSnapshot", function () {
        it("Should serialize and deserialize", function () {
          var t = Xe.from_node(n).serialize();
          Qe.deepEqual(t, Xe.deserialize(t).serialize());
        });
      }),
        describe("CollectionSnapshot", function () {
          it("Should serialize and deserialize", function () {
            var t = Ke.from_node_collection(e).serialize();
            Qe.deepEqual(t, Ke.deserialize(t).serialize());
          });
        }),
        describe("CollectionDiff", function () {
          it("Should serialize and deserialize", function () {
            var t = en(),
              e = t.node_collection,
              n = t.node,
              r = t.node1,
              i = t.node2,
              o = t.node3,
              s = t.now,
              a = Ke.from_node_collection(e),
              c = r.get_loc_id(),
              u = i.get_loc_id(),
              h = o.get_loc_id();
            r.detach(), o.detach(), n.attach_child(0, o);
            var d = e.create_node();
            d.set_meta(new Te().set_content("Child node 4").write()),
              d.set_created_ts(s),
              d.set_edited_ts(s),
              d.set_attached_ts(s),
              n.attach_child(1, d);
            var l = o.get_loc_id(),
              _ = d.get_loc_id(),
              p = Ke.from_node_collection(e),
              f = Ge.make_diff(a, p);
            f.sort_forward();
            var g = f.net_serialize_old(),
              y = {
                added: [d.get_id()],
                removed: [r.get_id()],
                meta: [
                  { id: r.get_id(), meta_old: r.get_meta() },
                  { id: d.get_id(), meta_new: d.get_meta() },
                ],
                location: [
                  {
                    id: r.get_id(),
                    parent_old: n.get_id(),
                    index_old: 0,
                    loc_id_old: c,
                  },
                  {
                    id: o.get_id(),
                    parent_old: n.get_id(),
                    index_old: 2,
                    loc_id_old: h,
                    parent_new: n.get_id(),
                    index_new: 0,
                    loc_id_new: l,
                  },
                  {
                    id: d.get_id(),
                    parent_new: n.get_id(),
                    index_new: 1,
                    loc_id_new: _,
                  },
                  {
                    id: i.get_id(),
                    parent_old: n.get_id(),
                    index_old: 1,
                    loc_id_old: u,
                    parent_new: n.get_id(),
                    index_new: 2,
                    loc_id_new: u,
                  },
                ],
                created: {},
              };
            (y.created[d.get_id()] = s),
              (y.created[r.get_id()] = s),
              Qe.deepEqual(g, y),
              Qe.deepEqual(g, Ge.net_deserialize(g, 0).net_serialize_old());
          });
        });
    }),
    describe("NodeParser", function () {
      describe("Recurring Date", function () {
        function e(t, e, n) {
          Qe.deepEqual($t(e).get_next_recurrence(t), n(yt(t)).valueOf(), e);
        }
        it("Should parse ignore spaces", function () {
          e(new Date(2018, 0, 1, 0, 0, 0).getTime(), "1 w 1", function (t) {
            return t.add(7, "d");
          });
        }),
          it("Should parse simple recurring days", function () {
            var t = new Date(2018, 0, 1, 0, 0, 0).getTime();
            e(t, "d", function (t) {
              return t.add(1, "d");
            }),
              e(t, "1d", function (t) {
                return t.add(1, "d");
              }),
              e(t, "2d", function (t) {
                return t.add(2, "d");
              }),
              e(t, "65d", function (t) {
                return t.add(65, "d");
              }),
              e(t, "600d", function (t) {
                return t.add(600, "d");
              });
          }),
          it("Should parse simple recurring weeks", function () {
            var t = new Date(2018, 0, 1, 0, 0, 0).getTime();
            e(t, "w", function (t) {
              return t.add(7, "d");
            }),
              e(t, "1w", function (t) {
                return t.add(7, "d");
              }),
              e(t, "2w", function (t) {
                return t.add(14, "d");
              }),
              e(t, "52w", function (t) {
                return t.add(364, "d");
              }),
              e(t, "200w", function (t) {
                return t.add(1400, "d");
              });
          }),
          it("Should parse simple recurring months", function () {
            var t = new Date(2018, 0, 1, 0, 0, 0).getTime();
            e(t, "m", function (t) {
              return t.add(31, "d");
            }),
              e(t, "1m", function (t) {
                return t.add(31, "d");
              }),
              e(t, "2m", function (t) {
                return t.add(59, "d");
              }),
              e(t, "12m", function (t) {
                return t.add(365, "d");
              }),
              e(t, "24m", function (t) {
                return t.add(730, "d");
              }),
              e(t, "48m", function (t) {
                return t.add(1461, "d");
              });
          }),
          it("Should parse simple recurring years", function () {
            var t = new Date(2018, 0, 1, 0, 0, 0).getTime();
            e(t, "y", function (t) {
              return t.add(365, "d");
            }),
              e(t, "1y", function (t) {
                return t.add(365, "d");
              }),
              e(t, "2y", function (t) {
                return t.add(730, "d");
              }),
              e(t, "4y", function (t) {
                return t.add(1461, "d");
              }),
              e(t, "10y", function (t) {
                return t.add(10, "y");
              });
          }),
          it("Should parse complex recurring weeks", function () {
            e(new Date(2018, 0, 1, 0, 0, 0).getTime(), "1w135", function (t) {
              return t.add(2, "d");
            }),
              e(new Date(2018, 0, 3, 0, 0, 0).getTime(), "1w135", function (t) {
                return t.add(2, "d");
              }),
              e(new Date(2018, 0, 5, 0, 0, 0).getTime(), "1w135", function (t) {
                return t.add(3, "d");
              }),
              e(new Date(2018, 0, 1, 0, 0, 0).getTime(), "2w135", function (t) {
                return t.add(2, "d");
              }),
              e(new Date(2018, 0, 3, 0, 0, 0).getTime(), "2w135", function (t) {
                return t.add(2, "d");
              }),
              e(new Date(2018, 0, 5, 0, 0, 0).getTime(), "2w135", function (t) {
                return t.add(10, "d");
              });
          });
      });
    });
})();
